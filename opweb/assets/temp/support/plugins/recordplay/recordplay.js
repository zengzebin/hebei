!function(){if($axure.document.configuration.showRecordPlay){$(window.document).ready(function(){$axure.player.createPluginHost({id:"recordPlayHost",context:"interface",title:"Recording"}),B(),$("#recordButton").click(p),$("#playButton").click(I),$("#stopButton").click(y),$("#deleteButton").click(P),$axure.page.bind("load.page_notes",function(){$.ajax({type:"POST",url:"/RecordController/ListRecordings",success:function(r){$("#recordNameHeader").html(""),$("#recordPlayContent").html(""),e=[],n||(t=0,n=[],o=0,a="",s={});for(var i in r.recordingList)u(r.recordingList[i]);return!1}})})});var e,n,t,o,r,i,a,s,c=new RegExp("^axRecording[0-9]{4}$","i"),d=new RegExp("[0-9]{4}$","i"),l=function(e){if(c.exec(e.recordingName)){var n=d.exec(e.recordingName),o=parseInt(n);t<o&&(t=o)}for(var r in e.eventList){var i=e.eventList[r];i.eventInfo={},i.eventInfo.srcElement=i.elementID,m(i.eventType)&&(i.eventInfo.mousePositions=[],i.eventInfo.mousePositions=i.mousePositions,i.timeStamp=i.mousePositions[0].timeStamp),f(i.eventType)&&(i.eventInfo.cursor={},i.eventInfo.cursor=i.cursor),"OnDrag"===i.eventType&&(i.eventInfo.dragInfo={},i.eventInfo.dragInfo=i.dragInfo,i.timeStamp=i.dragInfo.startTime)}return e},u=function(n){$.ajax({type:"POST",url:"/RecordController/GetRecording",data:{recordingId:n.recordingId},success:function(n){e[e.length]=l(n),$("#recordingContainer").find("li").filter(".recordingRootNode").append(x(n)),T(n)}})},g=function(e,n){var t=function(e,n){return n>0?t("0"+e,n-1):e};return t(e,n-String(e).length)},v=function(){return"axRecording"+g(t,4)},f=function(e){return"OnClick"===e||"OnMouseUp"===e||"OnMouseDown"===e||"OnMouseOver"===e||"OnKeyUp"===e||"OnSelectedChange"===e||"OnSelect"===e||"OnUnselect"===e||"OnTextChange"===e||"OnMouseOut"===e},m=function(e){return"OnMouseHover"===e||"OnMouseMove"===e};$axure.messageCenter.addMessageListener(function(e,t){var o,r;if("logEvent"===e){if(a!==t.elementID&&(s={},a=t.elementID),m(t.eventType))o=s[t.eventType],o?(r=o.eventInfo.mousePositions,r[r.length]={cursor:t.eventInfo.cursor,timeStamp:t.timeStamp}):(t.eventInfo.mousePositions=[],t.eventInfo.mousePositions[0]={cursor:t.eventInfo.cursor,timeStamp:t.timeStamp},n[n.length]=t,s[t.eventType]=t);else;f(t.eventType)&&(n[n.length]=t,s={},a=t.elementID),"OnDrag"===t.eventType&&(o=s[t.eventType],o?(r=o.eventInfo.mousePositions,r[r.length]={dragInfo:t.eventInfo.dragInfo,timeStamp:t.timeStamp}):(t.eventInfo.mousePositions=[],t.eventInfo.mousePositions[0]={dragInfo:t.eventInfo.dragInfo,timeStamp:t.timeStamp},n[n.length]=t,s[t.eventType]=t))}});var p=function(e){$("#recordButton").addClass("recordPlayButtonSelected"),t++,o=(new Date).getTime(),$.ajax({type:"POST",url:"/RecordController/CreateRecording",data:{recordingName:v(),timeStamp:o},success:function(e){r=e.recordingId,i=e.recordingName,$axure.messageCenter.postMessage("startRecording",{recordingId:r,recordingName:i})}})},I=function(e){$("#playButton").addClass("recordPlayButtonSelected")},y=function(t){var a,c,d;if($("#sitemapLinksContainer").toggle(),$("#recordButton").is(".recordPlayButtonSelected")){$("#recordButton").removeClass("recordPlayButtonSelected"),a={recordingId:r,recordingName:i,eventList:n},e[e.length]=a,c=$("#recordingContainer").find("li").filter(".recordingRootNode"),c.append(x(a)),T(a),s={};var l=[];for(var u in n){var g=n[u];if("OnDrag"===g.eventType){var v=g.eventInfo.mousePositions[g.eventInfo.mousePositions.length-1].dragInfo;g.eventInfo.dragInfo.currentX=v.currentX,g.eventInfo.dragInfo.currentY=v.currentY,g.eventInfo.dragInfo.currentTime=v.currentTime,g.eventInfo.dragInfo.xDelta=g.eventInfo.dragInfo.currentX-g.eventInfo.dragInfo.lastX,g.eventInfo.dragInfo.yDelta=g.eventInfo.dragInfo.currentY-g.eventInfo.dragInfo.lastY,d={},d=S(d,g,["eventType","elementID","path"]),d=S(d,g.eventInfo,["dragInfo"]),d.recordingId=r}f(g.eventType)&&(d={},d=S(d,g,["timeStamp","eventType","elementID","path"]),d=S(d,g.eventInfo,["cursor"]),d.recordingId=r),m(g.eventType)&&(d={},d=S(d,g,["eventType","elementID","path"]),d=S(d,g.eventInfo,["mousePositions"]),d.recordingId=r),l[l.length]=d}n=[],$axure.messageCenter.postMessage("stopRecording",void 0);var p={recordingName:i,recordingId:r,recordingStart:(new Date).getTime(),recordingEnd:o,eventList:l};$.ajax({type:"POST",url:"/RecordController/StopRecording",data:{jsonText:JSON.stringify(p)}})}$("#playButton").is(".recordPlayButtonSelected")&&$("#playButton").removeClass("recordPlayButtonSelected")},P=function(e){$.ajax({type:"POST",url:"/RecordController/DeleteRecordings",success:function(e){}})},S=function(e,n,t){for(var o in t)e[t[o]]=n[t[o]];return e},T=function(e){for(var n in e.eventList){var t=e.eventList[n],o=e.recordingId+"_"+t.timeStamp;C=o,$("#"+o).click(h(e.recordingId,t.timeStamp))}},x=function(e){var n,t,o,r='<ul class="recordingTree">';r+="<li class='recordingNode recordingExpandableNode'>",r+='<div class="recordingContainer" style="margin-left:15px">',r+='<a class="recordingPlusMinusLink"><span class="recordingMinus"></span></a>',r+='<a class="recordingPageLink" nodeurl="home.html">',r+='<span class="recordingPageIcon"></span>',r+='<span class="recordingPageName">'+e.recordingName+"</span>",r+="</a>",r+="<ul>";for(t in e.eventList){n=e.eventList[t],r+='<li class="recordingNode recordingLeafNode">',r+='<div class="recordingEventContainer" style="margin-left:44px">';var t=e.recordingId+"_"+n.timeStamp;r+='<a id="'+t+'" class="sitemapPageLink">',r+="Event ID: "+t+"<br/>",r+='<span class="sitemapPageIcon"></span>',r+='<span class="sitemapPageName">',r+="elementID: "+n.elementID+"<br/>",r+="eventType: "+n.eventType+"<br/>";for(o in n.path)r+="/"+n.path[o];r+="<br/>",r+="</span>",r+="</a>",r+="</div>",r+="</li>"}return r+="</ul>",r+="</div>",r+="</li>",r+="</ul>"},C="",h=function(n,t){for(var o in e)if(e[o].recordingId===n)for(var r in e[o].eventList)if(e[o].eventList[r].timeStamp===t){var i,a,s=e[o].eventList[r];a=s.eventType.toLowerCase(),"onclick"===a||"onmousein"===a?(i={},i=S(i,s.eventInfo,["cursor","timeStamp","srcElement"]),s.eventInfo.inputType&&(i=S(i,s.eventInfo,["inputType","inputValue"]))):i=s.eventInfo;var c={element:s.elementID,eventInfo:i,eventType:s.eventType};return function(){$axure.messageCenter.postMessage("playEvent",c)}}},B=function(){var e="<div id='recordPlayContainer'>";e+="<div id='recordPlayToolbar'>",e+="<div style='height:30px;'>",e+="<a id='recordButton' title='Start a Recording' class='recordPlayButton'></a>",e+="<a id='playButton' title='Play Back a Recording' class='recordPlayButton'></a>",e+="<a id='stopButton' title='Stop' class='recordPlayButton'></a>",e+="<a id='deleteButton' title='Delete All Recordings' class='recordPlayButton'></a>",e+="</div>",e+="<div id='recordingContainer'><li class='recordingNode recordingRootNode'></li></div>",e+="</div>",$("#recordPlayHost").html(e)}}}();