!function(e){"object"==typeof module&&module.exports?module.exports=e:e(Highcharts)}(function(e){var t,r=e.win,s=r.document,n=e.each,o=e.pick,i=e.inArray,a=e.isNumber,l=e.splat,u=function(e,t){this.init(e,t)};e.extend(u.prototype,{init:function(e,t){this.options=e,this.chartOptions=t,this.columns=e.columns||this.rowsToColumns(e.rows)||[],this.firstRowAsNames=o(e.firstRowAsNames,!0),this.decimalRegex=e.decimalPoint&&new RegExp("^(-?[0-9]+)"+e.decimalPoint+"([0-9]+)$"),this.rawColumns=[],this.columns.length?this.dataFound():(this.parseCSV(),this.parseTable(),this.parseGoogleSpreadsheet())},getColumnDistribution:function(){var r,s=this.chartOptions,o=this.options,i=[],a=function(t){return(e.seriesTypes[t||"line"].prototype.pointArrayMap||[0]).length},l=function(t){return e.seriesTypes[t||"line"].prototype.pointArrayMap},u=s&&s.chart&&s.chart.type,h=[],m=[],d=0;n(s&&s.series||[],function(e){h.push(a(e.type||u))}),n(o&&o.seriesMapping||[],function(e){i.push(e.x||0)}),0===i.length&&i.push(0),n(o&&o.seriesMapping||[],function(e){var n,o=new t,i=h[d]||a(u),p=s&&s.series||[],c=p[d]||{},f=l(c.type||u)||["y"];o.addColumnReader(e.x,"x");for(n in e)e.hasOwnProperty(n)&&"x"!==n&&o.addColumnReader(e[n],n);for(r=0;r<i;r++)o.hasReader(f[r])||o.addColumnReader(void 0,f[r]);m.push(o),d++});var p=l(u);void 0===p&&(p=["y"]),this.valueCount={global:a(u),xColumns:i,individual:h,seriesBuilders:m,globalPointArrayMap:p}},dataFound:function(){this.options.switchRowsAndColumns&&(this.columns=this.rowsToColumns(this.columns)),this.getColumnDistribution(),this.parseTypes(),!1!==this.parsed()&&this.complete()},parseCSV:function(){var e,t,r=this,s=this.options,o=s.csv,i=this.columns,a=s.startRow||0,l=s.endRow||Number.MAX_VALUE,u=s.startColumn||0,h=s.endColumn||Number.MAX_VALUE,m=0;o&&(t=o.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split(s.lineDelimiter||"\n"),e=s.itemDelimiter||(-1!==o.indexOf("\t")?"\t":","),n(t,function(t,s){var o,d=r.trim(t),p=0===d.indexOf("#"),c=""===d;s>=a&&s<=l&&!p&&!c&&(o=t.split(e),n(o,function(e,t){t>=u&&t<=h&&(i[t-u]||(i[t-u]=[]),i[t-u][m]=e)}),m+=1)}),this.dataFound())},parseTable:function(){var e=this.options,t=e.table,r=this.columns,o=e.startRow||0,i=e.endRow||Number.MAX_VALUE,a=e.startColumn||0,l=e.endColumn||Number.MAX_VALUE;t&&("string"==typeof t&&(t=s.getElementById(t)),n(t.getElementsByTagName("tr"),function(e,t){t>=o&&t<=i&&n(e.children,function(e,s){("TD"===e.tagName||"TH"===e.tagName)&&s>=a&&s<=l&&(r[s-a]||(r[s-a]=[]),r[s-a][t-o]=e.innerHTML)})}),this.dataFound())},parseGoogleSpreadsheet:function(){var e,t,r=this,s=this.options,o=s.googleSpreadsheetKey,i=this.columns,a=s.startRow||0,l=s.endRow||Number.MAX_VALUE,u=s.startColumn||0,h=s.endColumn||Number.MAX_VALUE;o&&jQuery.ajax({dataType:"json",url:"https://spreadsheets.google.com/feeds/cells/"+o+"/"+(s.googleSpreadsheetWorksheet||"od6")+"/public/values?alt=json-in-script&callback=?",error:s.error,success:function(s){var o,m,d=s.feed.entry,p=d.length,c=0,f=0;for(m=0;m<p;m++)o=d[m],c=Math.max(c,o.gs$cell.col),f=Math.max(f,o.gs$cell.row);for(m=0;m<c;m++)m>=u&&m<=h&&(i[m-u]=[],i[m-u].length=Math.min(f,l-a));for(m=0;m<p;m++)o=d[m],e=o.gs$cell.row-1,(t=o.gs$cell.col-1)>=u&&t<=h&&e>=a&&e<=l&&(i[t-u][e-a]=o.content.$t);n(i,function(e){for(m=0;m<e.length;m++)void 0===e[m]&&(e[m]=null)}),r.dataFound()}})},trim:function(e,t){return"string"==typeof e&&(e=e.replace(/^\s+|\s+$/g,""),t&&/^[0-9\s]+$/.test(e)&&(e=e.replace(/\s/g,"")),this.decimalRegex&&(e=e.replace(this.decimalRegex,"$1.$2"))),e},parseTypes:function(){for(var e=this.columns,t=e.length;t--;)this.parseColumn(e[t],t)},parseColumn:function(e,t){var r,s,n,o,u,h,m,d=this.rawColumns,p=this.columns,c=e.length,f=this.firstRowAsNames,g=-1!==i(t,this.valueCount.xColumns),v=[],x=this.chartOptions,C=this.options.columnTypes||[],y=C[t],w=g&&(x&&x.xAxis&&"category"===l(x.xAxis)[0].type||"string"===y);for(d[t]||(d[t]=[]);c--;)r=v[c]||e[c],n=this.trim(r),o=this.trim(r,!0),s=parseFloat(o),void 0===d[t][c]&&(d[t][c]=n),w||0===c&&f?e[c]=n:+o===s?(e[c]=s,s>31536e6&&"float"!==y?e.isDatetime=!0:e.isNumeric=!0,void 0!==e[c+1]&&(m=s>e[c+1])):(u=this.parseDate(r),g&&a(u)&&"float"!==y?(v[c]=r,e[c]=u,e.isDatetime=!0,void 0!==e[c+1]&&(h=u>e[c+1],h!==m&&void 0!==m&&(this.alternativeFormat?(this.dateFormat=this.alternativeFormat,c=e.length,this.alternativeFormat=this.dateFormats[this.dateFormat].alternative):e.unsorted=!0),m=h)):(e[c]=""===n?null:n,0!==c&&(e.isDatetime||e.isNumeric)&&(e.mixed=!0)));if(g&&e.mixed&&(p[t]=d[t]),g&&m&&this.options.sort)for(t=0;t<p.length;t++)p[t].reverse(),f&&p[t].unshift(p[t].pop())},dateFormats:{"YYYY-mm-dd":{regex:/^([0-9]{4})[\-\/\.]([0-9]{2})[\-\/\.]([0-9]{2})$/,parser:function(e){return Date.UTC(+e[1],e[2]-1,+e[3])}},"dd/mm/YYYY":{regex:/^([0-9]{1,2})[\-\/\.]([0-9]{1,2})[\-\/\.]([0-9]{4})$/,parser:function(e){return Date.UTC(+e[3],e[2]-1,+e[1])},alternative:"mm/dd/YYYY"},"mm/dd/YYYY":{regex:/^([0-9]{1,2})[\-\/\.]([0-9]{1,2})[\-\/\.]([0-9]{4})$/,parser:function(e){return Date.UTC(+e[3],e[1]-1,+e[2])}},"dd/mm/YY":{regex:/^([0-9]{1,2})[\-\/\.]([0-9]{1,2})[\-\/\.]([0-9]{2})$/,parser:function(e){return Date.UTC(+e[3]+2e3,e[2]-1,+e[1])},alternative:"mm/dd/YY"},"mm/dd/YY":{regex:/^([0-9]{1,2})[\-\/\.]([0-9]{1,2})[\-\/\.]([0-9]{2})$/,parser:function(e){return Date.UTC(+e[3]+2e3,e[1]-1,+e[2])}}},parseDate:function(e){var t,r,s,n,o=this.options.parseDate,i=this.options.dateFormat||this.dateFormat;if(o)t=o(e);else if("string"==typeof e){if(i)s=this.dateFormats[i],(n=e.match(s.regex))&&(t=s.parser(n));else for(r in this.dateFormats)if(s=this.dateFormats[r],n=e.match(s.regex)){this.dateFormat=i=r,this.alternativeFormat=s.alternative,t=s.parser(n);break}n||(n=Date.parse(e),"object"==typeof n&&null!==n&&n.getTime?t=n.getTime()-6e4*n.getTimezoneOffset():a(n)&&(t=n-6e4*new Date(n).getTimezoneOffset()))}return t},rowsToColumns:function(e){var t,r,s,n,o;if(e)for(o=[],r=e.length,t=0;t<r;t++)for(n=e[t].length,s=0;s<n;s++)o[s]||(o[s]=[]),o[s][t]=e[t][s];return o},parsed:function(){if(this.options.parsed)return this.options.parsed.call(this,this.columns)},getFreeIndexes:function(e,t){var r,s,n,o=[],i=[];for(s=0;s<e;s+=1)o.push(!0);for(r=0;r<t.length;r+=1)for(n=t[r].getReferencedColumnIndexes(),s=0;s<n.length;s+=1)o[n[s]]=!1;for(s=0;s<o.length;s+=1)o[s]&&i.push(s);return i},complete:function(){var e,r,s,n,o,a,l,u,h,m,d,p,c=this.columns,f=[],g=this.options,v=[];if(f.length=c.length,g.complete||g.afterComplete){for(n=0;n<c.length;n++)this.firstRowAsNames&&(c[n].name=c[n].shift());for(r=[],m=this.getFreeIndexes(c.length,this.valueCount.seriesBuilders),l=0;l<this.valueCount.seriesBuilders.length;l++)h=this.valueCount.seriesBuilders[l],h.populateColumns(m)&&v.push(h);for(;m.length>0;){for(h=new t,h.addColumnReader(0,"x"),p=i(0,m),-1!==p&&m.splice(p,1),n=0;n<this.valueCount.global;n++)h.addColumnReader(void 0,this.valueCount.globalPointArrayMap[n]);h.populateColumns(m)&&v.push(h)}if(v.length>0&&v[0].readers.length>0&&void 0!==(d=c[v[0].readers[0].columnIndex])&&(d.isDatetime?e="datetime":d.isNumeric||(e="category")),"category"===e)for(l=0;l<v.length;l++)for(h=v[l],a=0;a<h.readers.length;a++)"x"===h.readers[a].configName&&(h.readers[a].configName="name");for(l=0;l<v.length;l++){for(h=v[l],s=[],o=0;o<c[0].length;o++)s[o]=h.read(c,o);r[l]={data:s},h.name&&(r[l].name=h.name),"category"===e&&(r[l].turboThreshold=0)}u={series:r},e&&(u.xAxis={type:e}),g.complete&&g.complete(u),g.afterComplete&&g.afterComplete(u)}}}),e.Data=u,e.data=function(e,t){return new u(e,t)},e.wrap(e.Chart.prototype,"init",function(t,r,s){var n=this;r&&r.data?e.data(e.extend(r.data,{afterComplete:function(o){var i,a;if(r.hasOwnProperty("series"))if("object"==typeof r.series)for(i=Math.max(r.series.length,o.series.length);i--;)a=r.series[i]||{},r.series[i]=e.merge(a,o.series[i]);else delete r.series;r=e.merge(o,r),t.call(n,r,s)}}),r):t.call(n,r,s)}),t=function(){this.readers=[],this.pointIsArray=!0},t.prototype.populateColumns=function(e){var t=this,r=!0;return n(t.readers,function(t){void 0===t.columnIndex&&(t.columnIndex=e.shift())}),n(t.readers,function(e){void 0===e.columnIndex&&(r=!1)}),r},t.prototype.read=function(e,t){var r,s=this,o=s.pointIsArray,i=o?[]:{};return n(s.readers,function(r){var s=e[r.columnIndex][t];o?i.push(s):i[r.configName]=s}),void 0===this.name&&s.readers.length>=2&&(r=s.getReferencedColumnIndexes(),r.length>=2&&(r.shift(),r.sort(),this.name=e[r.shift()].name)),i},t.prototype.addColumnReader=function(e,t){this.readers.push({columnIndex:e,configName:t}),"x"!==t&&"y"!==t&&void 0!==t&&(this.pointIsArray=!1)},t.prototype.getReferencedColumnIndexes=function(){var e,t,r=[];for(e=0;e<this.readers.length;e+=1)t=this.readers[e],void 0!==t.columnIndex&&r.push(t.columnIndex);return r},t.prototype.hasReader=function(e){var t,r;for(t=0;t<this.readers.length;t+=1)if(r=this.readers[t],r.configName===e)return!0}});