!function(e){"function"==typeof define&&define.amd?define(["jquery","fuelux/combobox","fuelux/infinite-scroll","fuelux/search","fuelux/selectlist"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./combobox"),require("./infinite-scroll"),require("./search"),require("./selectlist")):e(jQuery)}(function(e){var t=e.fn.repeater,i=function(t,i){var n,s,r=this;this.$element=e(t),this.$canvas=this.$element.find(".repeater-canvas"),this.$count=this.$element.find(".repeater-count"),this.$end=this.$element.find(".repeater-end"),this.$filters=this.$element.find(".repeater-filters"),this.$loader=this.$element.find(".repeater-loader"),this.$pageSize=this.$element.find(".repeater-itemization .selectlist"),this.$nextBtn=this.$element.find(".repeater-next"),this.$pages=this.$element.find(".repeater-pages"),this.$prevBtn=this.$element.find(".repeater-prev"),this.$primaryPaging=this.$element.find(".repeater-primaryPaging"),this.$search=this.$element.find(".repeater-search").find(".search"),this.$secondaryPaging=this.$element.find(".repeater-secondaryPaging"),this.$start=this.$element.find(".repeater-start"),this.$viewport=this.$element.find(".repeater-viewport"),this.$views=this.$element.find(".repeater-views"),this.currentPage=0,this.currentView=null,this.isDisabled=!1,this.infiniteScrollingCallback=function(){},this.infiniteScrollingCont=null,this.infiniteScrollingEnabled=!1,this.infiniteScrollingEnd=null,this.infiniteScrollingOptions={},this.lastPageInput=0,this.options=e.extend({},e.fn.repeater.defaults,i),this.pageIncrement=0,this.resizeTimeout={},this.stamp=(new Date).getTime()+(Math.floor(100*Math.random())+1),this.storedDataSourceOpts=null,this.syncingViewButtonState=!1,this.viewOptions={},this.viewType=null,this.$filters.selectlist(),this.$pageSize.selectlist(),this.$primaryPaging.find(".combobox").combobox(),this.$search.search({searchOnKeyPress:this.options.searchOnKeyPress,allowCancel:this.options.allowCancel}),this.$filters.on("changed.fu.selectlist",function(e,t){r.$element.trigger("filtered.fu.repeater",t),r.render({clearInfinite:!0,pageIncrement:null})}),this.$nextBtn.on("click.fu.repeater",e.proxy(this.next,this)),this.$pageSize.on("changed.fu.selectlist",function(e,t){r.$element.trigger("pageSizeChanged.fu.repeater",t),r.render({pageIncrement:null})}),this.$prevBtn.on("click.fu.repeater",e.proxy(this.previous,this)),this.$primaryPaging.find(".combobox").on("changed.fu.combobox",function(e,t){r.pageInputChange(t.text,t)}),this.$search.on("searched.fu.search cleared.fu.search",function(e,t){r.$element.trigger("searchChanged.fu.repeater",t),r.render({clearInfinite:!0,pageIncrement:null})}),this.$search.on("canceled.fu.search",function(e,t){r.$element.trigger("canceled.fu.repeater",t),r.render({clearInfinite:!0,pageIncrement:null})}),this.$secondaryPaging.on("blur.fu.repeater",function(e){r.pageInputChange(r.$secondaryPaging.val())}),this.$secondaryPaging.on("keyup",function(e){13===e.keyCode&&r.pageInputChange(r.$secondaryPaging.val())}),this.$views.find("input").on("change.fu.repeater",e.proxy(this.viewChanged,this)),e(window).on("resize.fu.repeater."+this.stamp,function(e){clearTimeout(r.resizeTimeout),r.resizeTimeout=setTimeout(function(){r.resize(),r.$element.trigger("resized.fu.repeater")},75)}),this.$loader.loader(),this.$loader.loader("pause"),-1!==this.options.defaultView?s=this.options.defaultView:(n=this.$views.find("label.active input"),s=n.length>0?n.val():"list"),this.setViewOptions(s),this.initViewTypes(function(){r.resize(),r.$element.trigger("resized.fu.repeater"),r.render({changeView:s})})};i.prototype={constructor:i,clear:function(t){function i(t){var n=[];t.children().each(function(){var t=e(this),s=t.attr("data-preserve");"deep"===s?(t.detach(),n.push(t)):"shallow"===s&&(i(t),t.detach(),n.push(t))}),t.empty(),t.append(n)}var n,s;t=t||{},t.preserve?this.infiniteScrollingEnabled&&!t.clearInfinite||i(this.$canvas):this.$canvas.empty(),n=void 0!==t.viewChanged&&t.viewChanged,s=e.fn.repeater.viewTypes[this.viewType]||{},!n&&s.cleared&&s.cleared.call(this,{options:t})},clearPreservedDataSourceOptions:function(){this.storedDataSourceOpts=null},destroy:function(){var t;return this.$element.find("input").each(function(){e(this).attr("value",e(this).val())}),this.$canvas.empty(),t=this.$element[0].outerHTML,this.$element.find(".combobox").combobox("destroy"),this.$element.find(".selectlist").selectlist("destroy"),this.$element.find(".search").search("destroy"),this.infiniteScrollingEnabled&&e(this.infiniteScrollingCont).infinitescroll("destroy"),this.$element.remove(),e(window).off("resize.fu.repeater."+this.stamp),t},disable:function(){var t=e.fn.repeater.viewTypes[this.viewType]||{};this.$search.search("disable"),this.$filters.selectlist("disable"),this.$views.find("label, input").addClass("disabled").attr("disabled","disabled"),this.$pageSize.selectlist("disable"),this.$primaryPaging.find(".combobox").combobox("disable"),this.$secondaryPaging.attr("disabled","disabled"),this.$prevBtn.attr("disabled","disabled"),this.$nextBtn.attr("disabled","disabled"),t.enabled&&t.enabled.call(this,{status:!1}),this.isDisabled=!0,this.$element.addClass("disabled"),this.$element.trigger("disabled.fu.repeater")},enable:function(){var t=e.fn.repeater.viewTypes[this.viewType]||{};this.$search.search("enable"),this.$filters.selectlist("enable"),this.$views.find("label, input").removeClass("disabled").removeAttr("disabled"),this.$pageSize.selectlist("enable"),this.$primaryPaging.find(".combobox").combobox("enable"),this.$secondaryPaging.removeAttr("disabled"),this.$prevBtn.hasClass("page-end")||this.$prevBtn.removeAttr("disabled"),this.$nextBtn.hasClass("page-end")||this.$nextBtn.removeAttr("disabled"),this.$prevBtn.hasClass("page-end")&&this.$nextBtn.hasClass("page-end")&&this.$primaryPaging.combobox("disable"),0!==parseInt(this.$count.html())?this.$pageSize.selectlist("enable"):this.$pageSize.selectlist("disable"),t.enabled&&t.enabled.call(this,{status:!0}),this.isDisabled=!1,this.$element.removeClass("disabled"),this.$element.trigger("enabled.fu.repeater")},getDataOptions:function(t){var i,n,s={},r={};return t=t||{},r.filter=this.$filters.length>0?this.$filters.selectlist("selectedItem"):{text:"All",value:"all"},r.view=this.currentView,this.infiniteScrollingEnabled||(r.pageSize=this.$pageSize.length>0?parseInt(this.$pageSize.selectlist("selectedItem").value,10):25),void 0!==t.pageIncrement&&(null===t.pageIncrement?this.currentPage=0:this.currentPage+=t.pageIncrement),r.pageIndex=this.currentPage,i=this.$search.length>0?this.$search.find("input").val():"",""!==i&&(r.search=i),t.dataSourceOptions&&(s=t.dataSourceOptions,t.preserveDataSourceOptions&&(this.storedDataSourceOpts=this.storedDataSourceOpts?e.extend(this.storedDataSourceOpts,s):s)),this.storedDataSourceOpts&&(s=e.extend(this.storedDataSourceOpts,s)),n=e.fn.repeater.viewTypes[this.viewType]||{},n=n.dataOptions,n?(n=n.call(this,r),r=e.extend(n,s)):r=e.extend(r,s),r},infiniteScrolling:function(e,t){var i,n,s=this.$element.find(".repeater-footer"),r=this.$element.find(".repeater-viewport");t=t||{},e?(this.infiniteScrollingEnabled=!0,this.infiniteScrollingEnd=t.end,delete t.dataSource,delete t.end,this.infiniteScrollingOptions=t,r.css({height:r.height()+s.outerHeight()}),s.hide()):(i=this.infiniteScrollingCont,n=i.data(),delete n.infinitescroll,i.off("scroll"),i.removeClass("infinitescroll"),this.infiniteScrollingCont=null,this.infiniteScrollingEnabled=!1,this.infiniteScrollingEnd=null,this.infiniteScrollingOptions={},r.css({height:r.height()-s.outerHeight()}),s.show())},infiniteScrollPaging:function(e,t){var i=!0!==this.infiniteScrollingEnd?this.infiniteScrollingEnd:void 0,n=e.page,s=e.pages;this.currentPage=void 0!==n?n:NaN,(!0===e.end||this.currentPage+1>=s)&&this.infiniteScrollingCont.infinitescroll("end",i)},initInfiniteScrolling:function(){var t,i,n=this.$canvas.find('[data-infinite="true"]:first');n=n.length<1?this.$canvas:n,n.data("fu.infinitescroll")?n.infinitescroll("enable"):(i=this,t=e.extend({},this.infiniteScrollingOptions),t.dataSource=function(e,t){i.infiniteScrollingCallback=t,i.render({pageIncrement:1})},n.infinitescroll(t),this.infiniteScrollingCont=n)},initViewTypes:function(t){function i(e){function n(){e++,e<s?i(e):t()}a[e].initialize?a[e].initialize.call(r,{},function(){n()}):n()}var n,s,r=this,a=[];for(n in e.fn.repeater.viewTypes)a.push(e.fn.repeater.viewTypes[n]);s=a.length,s>0?i(0):t()},itemization:function(e){this.$count.html(void 0!==e.count?e.count:"?"),this.$end.html(void 0!==e.end?e.end:"?"),this.$start.html(void 0!==e.start?e.start:"?")},next:function(e){var t="disabled";this.$nextBtn.attr(t,t),this.$prevBtn.attr(t,t),this.pageIncrement=1,this.$element.trigger("nextClicked.fu.repeater"),this.render({pageIncrement:this.pageIncrement})},pageInputChange:function(e,t){var i;e!==this.lastPageInput&&(this.lastPageInput=e,e=parseInt(e,10)-1,i=e-this.currentPage,this.$element.trigger("pageChanged.fu.repeater",[e,t]),this.render({pageIncrement:i}))},pagination:function(e){var t,i,n,s,r="active",a="disabled",l=e.page,o=e.pages;if(this.currentPage=void 0!==l?l:NaN,this.$primaryPaging.removeClass(r),this.$secondaryPaging.removeClass(r),s=0===o?0:this.currentPage+1,o<=this.viewOptions.dropPagingCap){for(this.$primaryPaging.addClass(r),t=this.$primaryPaging.find(".dropdown-menu"),t.empty(),i=0;i<o;i++)n=i+1,t.append('<li data-value="'+n+'"><a href="#">'+n+"</a></li>");this.$primaryPaging.find("input.form-control").val(s)}else this.$secondaryPaging.addClass(r),this.$secondaryPaging.val(s);this.lastPageInput=this.currentPage+1+"",this.$pages.html(""+o),this.currentPage+1<o?(this.$nextBtn.removeAttr(a),this.$nextBtn.removeClass("page-end")):(this.$nextBtn.attr(a,a),this.$nextBtn.addClass("page-end")),this.currentPage-1>=0?(this.$prevBtn.removeAttr(a),this.$prevBtn.removeClass("page-end")):(this.$prevBtn.attr(a,a),this.$prevBtn.addClass("page-end")),0!==this.pageIncrement&&(this.pageIncrement>0?this.$nextBtn.is(":disabled")?this.$prevBtn.focus():this.$nextBtn.focus():this.$prevBtn.is(":disabled")?this.$nextBtn.focus():this.$prevBtn.focus())},previous:function(){var e="disabled";this.$nextBtn.attr(e,e),this.$prevBtn.attr(e,e),this.pageIncrement=-1,this.$element.trigger("previousClicked.fu.repeater"),this.render({pageIncrement:this.pageIncrement})},render:function(t){var i,n,s=this,r=!1,a=e.fn.repeater.viewTypes[this.viewType]||{};t=t||{},this.disable(),t.changeView&&this.currentView!==t.changeView&&(n=this.currentView,this.currentView=t.changeView,this.viewType=this.currentView.split(".")[0],this.setViewOptions(this.currentView),this.$element.attr("data-currentview",this.currentView),this.$element.attr("data-viewtype",this.viewType),r=!0,t.viewChanged=r,this.$element.trigger("viewChanged.fu.repeater",this.currentView),this.infiniteScrollingEnabled&&s.infiniteScrolling(!1),a=e.fn.repeater.viewTypes[this.viewType]||{},a.selected&&a.selected.call(this,{prevView:n})),this.syncViewButtonState(),t.preserve=void 0!==t.preserve?t.preserve:!r,this.clear(t),(!this.infiniteScrollingEnabled||this.infiniteScrollingEnabled&&r)&&this.$loader.show().loader("play"),i=this.getDataOptions(t),this.viewOptions.dataSource(i,function(e){e=e||{},s.infiniteScrollingEnabled?s.infiniteScrollingCallback({}):(s.itemization(e),s.pagination(e)),s.runRenderer(a,e,function(){s.infiniteScrollingEnabled&&((r||t.clearInfinite)&&s.initInfiniteScrolling(),s.infiniteScrollPaging(e,t)),s.$loader.hide().loader("pause"),s.enable(),s.$search.trigger("rendered.fu.repeater"),s.$element.trigger("rendered.fu.repeater",{data:e,options:i,renderOptions:t}),s.$element.trigger("loaded.fu.repeater",i)})})},resize:function(){var t,i,n=-1===this.viewOptions.staticHeight?this.$element.attr("data-staticheight"):this.viewOptions.staticHeight,s={};if(this.viewType&&(s=e.fn.repeater.viewTypes[this.viewType]||{}),void 0!==n&&!1!==n&&"false"!==n){this.$canvas.addClass("scrolling"),i={bottom:this.$viewport.css("margin-bottom"),top:this.$viewport.css("margin-top")};t=("true"===n||!0===n?this.$element.height():parseInt(n,10))-this.$element.find(".repeater-header").outerHeight()-this.$element.find(".repeater-footer").outerHeight()-("auto"===i.bottom?0:parseInt(i.bottom,10))-("auto"===i.top?0:parseInt(i.top,10)),this.$viewport.outerHeight(t)}else this.$canvas.removeClass("scrolling");s.resize&&s.resize.call(this,{height:this.$element.outerHeight(),width:this.$element.outerWidth()})},runRenderer:function(t,i,n){function s(t,i){var n;i&&"none"!==(n=i.action?i.action:"append")&&void 0!==i.item&&(t=void 0!==i.container?e(i.container):t,t[n](i.item))}var r,a,l,o,h,c;if(t.render)t.render.call(this,{container:this.$canvas,data:i},function(){n()});else{if(t.before&&(o=t.before.call(this,{container:this.$canvas,data:i}),s(this.$canvas,o)),r=this.$canvas.find('[data-container="true"]:last'),r=r.length>0?r:this.$canvas,t.renderItem){for(h=t.repeat||"data.items",h=h.split("."),"data"===h[0]||"this"===h[0]?(c="this"===h[0]?this:i,h.shift()):(h=[],c=[],window.console&&window.console.warn&&window.console.warn('WARNING: Repeater plugin "repeat" value must start with either "data" or "this"')),a=0,l=h.length;a<l;a++){if(void 0===c[h[a]]){c=[],window.console&&window.console.warn&&window.console.warn("WARNING: Repeater unable to find property to iterate renderItem on.");break}c=c[h[a]]}for(a=0,l=c.length;a<l;a++)o=t.renderItem.call(this,{container:r,data:i,index:a,subset:c}),s(r,o)}t.after&&(o=t.after.call(this,{container:this.$canvas,data:i}),s(this.$canvas,o)),n()}},setViewOptions:function(t){var i={},n=t.split(".")[1];i=this.options.views?this.options.views[n]||this.options.views[t]||{}:{},this.viewOptions=e.extend({},this.options,i)},viewChanged:function(t){var i=e(t.target),n=i.val();this.syncingViewButtonState||(this.isDisabled||i.parents("label:first").hasClass("disabled")?this.syncViewButtonState():this.render({changeView:n,pageIncrement:null}))},syncViewButtonState:function(){var e=this.$views.find('input[value="'+this.currentView+'"]');this.syncingViewButtonState=!0,this.$views.find("input").prop("checked",!1),this.$views.find("label.active").removeClass("active"),e.length>0&&(e.prop("checked",!0),e.parents("label:first").addClass("active")),this.syncingViewButtonState=!1}},e.fn.repeater=function(t){var n,s=Array.prototype.slice.call(arguments,1),r=this.each(function(){var r=e(this),a=r.data("fu.repeater"),l="object"==typeof t&&t;a||r.data("fu.repeater",a=new i(this,l)),"string"==typeof t&&(n=a[t].apply(a,s))});return void 0===n?r:n},e.fn.repeater.defaults={dataSource:function(e,t){t({count:0,end:0,items:[],page:0,pages:1,start:0})},defaultView:-1,dropPagingCap:10,staticHeight:-1,views:null,searchOnKeyPress:!1,allowCancel:!0},e.fn.repeater.viewTypes={},e.fn.repeater.Constructor=i,e.fn.repeater.noConflict=function(){return e.fn.repeater=t,this}});