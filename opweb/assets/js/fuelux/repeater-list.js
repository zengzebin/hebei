!function(e){"function"==typeof define&&define.amd?define(["jquery","fuelux/repeater","fuelux/checkbox"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./repeater"),require("./checkbox")):e(jQuery)}(function(e){function t(e,t){if(!t)return!1;if(!e||t.length!==e.length)return!0;for(var i=0;i<t.length;i++){if(!e[i])return!0;for(var s in t[i])if(e[i][s]!==t[i][s])return!0}return!1}function i(t,i,s,n,r){var a=n[r].className,l=i[s][n[r].property],o=e("<td></td>"),d=n[r]._auto_width,c=n[r].property;if(!1!==this.viewOptions.list_actions&&"@_ACTIONS_@"===c&&(l='<div class="repeater-list-actions-placeholder" style="width: '+this.list_actions_width+'px"></div>'),l=void 0!==l?l:"",o.addClass(void 0!==a?a:"").append(l),void 0!==d&&o.outerWidth(d),t.append(o),"multi"===this.viewOptions.list_selectable&&"@_CHECKBOX_@"===n[r].property){var p='<label data-row="'+s+'" class="checkbox-custom checkbox-inline body-checkbox repeater-select-checkbox"><input class="sr-only" type="checkbox"></label>';o.html(p)}"@_CHECKBOX_@"!==n[r].property&&"@_ACTIONS_@"!==n[r].property&&this.viewOptions.list_columnRendered&&this.viewOptions.list_columnRendered({container:t,columnAttr:n[r].property,item:o,rowData:i[s]},function(){})}function s(t,i,s){var n,r,a,l,o,d="glyphicon-chevron-down",c="glyphicon-chevron-up",p=e('<div class="repeater-list-heading"><span class="glyphicon rlc"></span></div>'),h=(this.$element.attr("id")+"_"||"")+"checkall",f='<div class="repeater-list-heading header-checkbox"><label id="'+h+'" class="checkbox-custom checkbox-inline"><input class="sr-only" type="checkbox" value=""><span class="checkbox-label">&nbsp;</span></label></div>',u=e("<th></th>"),m=this;if(p.data("fu_item_index",s),p.prepend(i[s].label),u.html(p.html()).find("[id]").removeAttr("id"),"@_CHECKBOX_@"!==i[s].property?u.append(p):u.append(f),n=u.add(p),l=p.find(".glyphicon.rlc:first"),o=l.add(u.find(".glyphicon.rlc:first")),this.viewOptions.list_actions&&"@_ACTIONS_@"===i[s].property){var v=this.list_actions_width;u.css("width",v),p.css("width",v)}r=i[s].className,void 0!==r&&n.addClass(r),a=i[s].sortable,a&&(n.addClass("sortable"),p.on("click.fu.repeaterList",function(){m.isDisabled||(m.list_sortProperty="string"==typeof a?a:i[s].property,p.hasClass("sorted")?l.hasClass(c)?(o.removeClass(c).addClass(d),m.list_sortDirection="desc"):m.viewOptions.list_sortClearing?(n.removeClass("sorted"),o.removeClass(d),m.list_sortDirection=null,m.list_sortProperty=null):(o.removeClass(d).addClass(c),m.list_sortDirection="asc"):(t.find("th, .repeater-list-heading").removeClass("sorted"),o.removeClass(d).addClass(c),m.list_sortDirection="asc",n.addClass("sorted")),m.render({clearInfinite:!0,pageIncrement:null}))})),"asc"!==i[s].sortDirection&&"desc"!==i[s].sortDirection||(t.find("th, .repeater-list-heading").removeClass("sorted"),n.addClass("sortable sorted"),"asc"===i[s].sortDirection?(o.addClass(c),this.list_sortDirection="asc"):(o.addClass(d),this.list_sortDirection="desc"),this.list_sortProperty="string"==typeof a?a:i[s].property),t.append(u)}function n(t,s,n){var r,a,l=e("<tr></tr>"),o=this,c="multi"===this.viewOptions.list_selectable,p=this.viewOptions.list_actions;for(this.viewOptions.list_selectable&&(l.data("item_data",s[n]),"action"!==this.viewOptions.list_selectable&&(l.addClass("selectable"),l.attr("tabindex",0),l.on("click.fu.repeaterList",function(){if(!o.isDisabled){var t=e(this),i=e(this).index();i+=1;var s=o.$element.find(".frozen-column-wrapper tr:nth-child("+i+")"),n=o.$element.find(".actions-column-wrapper tr:nth-child("+i+")"),r=o.$element.find(".frozen-column-wrapper tr:nth-child("+i+") .checkbox-inline");t.is(".selected")?(t.removeClass("selected"),c?(r.click(),s.removeClass("selected"),p&&n.removeClass("selected")):t.find(".repeater-list-check").remove(),o.$element.trigger("deselected.fu.repeaterList",t)):(c?(r.click(),t.addClass("selected"),s.addClass("selected"),p&&n.addClass("selected")):(o.$canvas.find(".repeater-list-check").remove(),o.$canvas.find(".repeater-list tbody tr.selected").each(function(){e(this).removeClass("selected"),o.$element.trigger("deselected.fu.repeaterList",e(this))}),t.find("td:first").prepend('<div class="repeater-list-check"><span class="glyphicon glyphicon-ok"></span></div>'),t.addClass("selected"),s.addClass("selected")),o.$element.trigger("selected.fu.repeaterList",t)),d.call(o)}}),l.keyup(function(e){13===e.keyCode&&l.trigger("click.fu.repeaterList")}))),this.viewOptions.list_actions&&!this.viewOptions.list_selectable&&l.data("item_data",s[n]),t.append(l),r=0,a=this.list_columns.length;r<a;r++)i.call(this,l,s,n,this.list_columns,r);this.viewOptions.list_rowRendered&&this.viewOptions.list_rowRendered({container:t,item:l,rowData:s[n]},function(){})}function r(t,i){var s,n=t.find("tbody");n.length<1&&(n=e('<tbody data-container="true"></tbody>'),t.append(n)),"string"==typeof i.error&&i.error.length>0?(s=e('<tr class="empty text-danger"><td colspan="'+this.list_columns.length+'"></td></tr>'),s.find("td").append(i.error),n.append(s)):i.items&&i.items.length<1&&(s=e('<tr class="empty"><td colspan="'+this.list_columns.length+'"></td></tr>'),s.find("td").append(this.viewOptions.list_noItemsHTML),n.append(s))}function a(i,n){var r,a,o,d=n.columns||[],c=i.find("thead");if(this.list_firstRender||t(this.list_columns,d)||0===c.length){if(c.remove(),"multi"===this.viewOptions.list_selectable&&!this.list_noItems){var p={label:"c",property:"@_CHECKBOX_@",sortable:!1};d.splice(0,0,p)}if(this.list_columns=d,this.list_firstRender=!1,this.$loader.removeClass("noHeader"),this.viewOptions.list_actions){var h={label:this.viewOptions.list_actions.label||'<span class="actions-hidden">a</span>',property:"@_ACTIONS_@",sortable:!1,width:this.list_actions_width};d.push(h)}for(c=e('<thead data-preserve="deep"><tr></tr></thead>'),o=c.find("tr"),r=0,a=d.length;r<a;r++)s.call(this,o,d,r);if(i.prepend(c),"multi"===this.viewOptions.list_selectable&&!this.list_noItems){var f=this.$element.find(".repeater-list-wrapper .header-checkbox").outerWidth();e.grep(d,function(e){return"@_CHECKBOX_@"===e.property})[0].width=f}l.call(this,o)}}function l(t){var i,s,n,r,a=[],l=this;if(this.viewOptions.list_columnSizing&&(i=0,r=0,t.find("th").each(function(){var t,s=e(this);if(void 0!==l.list_columns[i].width)t=l.list_columns[i].width,s.outerWidth(t),r+=s.outerWidth(),l.list_columns[i]._auto_width=t;else{var n=s.find(".repeater-list-heading").outerWidth();a.push({col:s,index:i,minWidth:n})}i++}),(s=a.length)>0)){var o=this.$canvas.find(".repeater-list-wrapper").outerWidth();for(n=Math.floor((o-r)/s),i=0;i<s;i++)a[i].minWidth>n&&(n=a[i].minWidth),a[i].col.outerWidth(n),this.list_columns[a[i].index]._auto_width=n}}function o(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),i=e.indexOf("Firefox");return t>0?"ie-"+parseInt(e.substring(t+5,e.indexOf(".",t))):i>0?"firefox":""}function d(){var e,t=".repeater-list-wrapper > table .selected",i=this.$element.find(".table-actions");"action"===this.viewOptions.list_selectable&&(t=".repeater-list-wrapper > table tr"),e=this.$canvas.find(t),e.length>0?i.find("thead .btn").removeAttr("disabled"):i.find("thead .btn").attr("disabled","disabled")}e.fn.repeater&&(e.fn.repeater.Constructor.prototype.list_clearSelectedItems=function(){this.$canvas.find(".repeater-list-check").remove(),this.$canvas.find(".repeater-list table tbody tr.selected").removeClass("selected")},e.fn.repeater.Constructor.prototype.list_highlightColumn=function(t,i){var s=this.$canvas.find(".repeater-list-wrapper > table tbody");(this.viewOptions.list_highlightSortedColumn||i)&&(s.find("td.sorted").removeClass("sorted"),s.find("tr").each(function(){e(this).find("td:nth-child("+(t+1)+")").filter(function(){return!e(this).parent().hasClass("empty")}).addClass("sorted")}))},e.fn.repeater.Constructor.prototype.list_getSelectedItems=function(){var t=[];return this.$canvas.find(".repeater-list .repeater-list-wrapper > table tbody tr.selected").each(function(){var i=e(this);t.push({data:i.data("item_data"),element:i})}),t},e.fn.repeater.Constructor.prototype.getValue=e.fn.repeater.Constructor.prototype.list_getSelectedItems,e.fn.repeater.Constructor.prototype.list_positionHeadings=function(){var t=this.$element.find(".repeater-list-wrapper"),i=t.offset().left;t.scrollLeft()>0?t.find(".repeater-list-heading").each(function(){var t=e(this),s=t.parents("th:first").offset().left-i+"px";t.addClass("shifted").css("left",s)}):t.find(".repeater-list-heading").each(function(){e(this).removeClass("shifted").css("left","")})},e.fn.repeater.Constructor.prototype.list_setSelectedItems=function(t,i){function s(i){l=e(this),r=l.data("item_data")||{},r[t[a].property]===t[a].value&&n(l,t[a].selected,i)}function n(e,t,s){var n;t=void 0===t||t,t?(i||"multi"===d||c.list_clearSelectedItems(),e.hasClass("selected")||(e.addClass("selected"),(c.viewOptions.list_frozenColumns||"multi"===c.viewOptions.list_selectable)&&(n=c.$element.find(".frozen-column-wrapper tr:nth-child("+(s+1)+")"),n.addClass("selected"),n.find(".repeater-select-checkbox").addClass("checked")),c.viewOptions.list_actions&&c.$element.find(".actions-column-wrapper tr:nth-child("+(s+1)+")").addClass("selected"),e.find("td:first").prepend('<div class="repeater-list-check"><span class="glyphicon glyphicon-ok"></span></div>'))):(c.viewOptions.list_frozenColumns&&(n=c.$element.find(".frozen-column-wrapper tr:nth-child("+(s+1)+")"),n.addClass("selected"),n.find(".repeater-select-checkbox").removeClass("checked")),c.viewOptions.list_actions&&c.$element.find(".actions-column-wrapper tr:nth-child("+(s+1)+")").removeClass("selected"),e.find(".repeater-list-check").remove(),e.removeClass("selected"))}var r,a,l,o,d=this.viewOptions.list_selectable,c=this;for(e.isArray(t)||(t=[t]),o=!0===i||"multi"===d?t.length:d&&t.length>0?1:0,a=0;a<o;a++)void 0!==t[a].index?(l=this.$canvas.find(".repeater-list .repeater-list-wrapper > table tbody tr:nth-child("+(t[a].index+1)+")"),l.length>0&&n(l,t[a].selected,t[a].index)):void 0!==t[a].property&&void 0!==t[a].value&&this.$canvas.find(".repeater-list .repeater-list-wrapper > table tbody tr").each(s)},e.fn.repeater.Constructor.prototype.list_sizeHeadings=function(){this.$element.find(".repeater-list table").find("thead th").each(function(){var t=e(this),i=t.find(".repeater-list-heading");i.css({height:t.outerHeight()}),i.outerWidth(i.data("forced-width")||t.outerWidth())})},e.fn.repeater.Constructor.prototype.list_setFrozenColumns=function(){var t=this.$canvas.find(".table-frozen"),i=this.$element.find(".repeater-canvas"),s=this.$element.find(".repeater-list .repeater-list-wrapper > table"),n=this.$element.find(".repeater-list"),r=this.viewOptions.list_frozenColumns,a=this;if("multi"===this.viewOptions.list_selectable&&(r+=1,i.addClass("multi-select-enabled")),t.length<1){var l=e('<div class="frozen-column-wrapper"></div>').insertBefore(s),o=s.clone().addClass("table-frozen");o.find("th:not(:lt("+r+"))").remove(),o.find("td:not(:nth-child(n+0):nth-child(-n+"+r+"))").remove();var d=o.clone().removeClass("table-frozen");d.find("tbody").remove();var c=e('<div class="frozen-thead-wrapper"></div>').append(d),p=c.find("th label.checkbox-custom.checkbox-inline");p.attr("id",p.attr("id")+"_cloned"),l.append(o),n.append(c),this.$canvas.addClass("frozen-enabled")}this.list_sizeFrozenColumns(),e(".frozen-thead-wrapper .repeater-list-heading").on("click",function(){var t=e(this).parent("th").index();t+=1,a.$element.find(".repeater-list-wrapper > table thead th:nth-child("+t+") .repeater-list-heading")[0].click()})},e.fn.repeater.Constructor.prototype.list_positionColumns=function(){var e=this.$element.find(".repeater-canvas"),t=e.scrollTop(),i=e.scrollLeft(),s=this.viewOptions.list_frozenColumns||"multi"===this.viewOptions.list_selectable,n=this.viewOptions.list_actions,r=this.$element.find(".repeater-canvas").outerWidth(),a=this.$element.find(".repeater-list .repeater-list-wrapper > table").outerWidth(),l=this.$element.find(".table-actions")?this.$element.find(".table-actions").outerWidth():0,o=a-(r-l)>=i;t>0?e.find(".repeater-list-heading").css("top",t):e.find(".repeater-list-heading").css("top","0"),i>0?(s&&(e.find(".frozen-thead-wrapper").css("left",i),e.find(".frozen-column-wrapper").css("left",i)),n&&o&&(e.find(".actions-thead-wrapper").css("right",-i),e.find(".actions-column-wrapper").css("right",-i))):(s&&(e.find(".frozen-thead-wrapper").css("left","0"),e.find(".frozen-column-wrapper").css("left","0")),n&&(e.find(".actions-thead-wrapper").css("right","0"),e.find(".actions-column-wrapper").css("right","0")))},e.fn.repeater.Constructor.prototype.list_createItemActions=function(){var t,i,s="",n=this,r=this.$element.find(".repeater-list .repeater-list-wrapper > table"),a=this.$canvas.find(".table-actions");for(t=0,i=this.viewOptions.list_actions.items.length;t<i;t++){var l=this.viewOptions.list_actions.items[t],o=l.html;s+='<li><a href="#" data-action="'+l.name+'" class="action-item"> '+o+"</a></li>"}var d='<div class="btn-group"><button type="button" class="btn btn-xs btn-default dropdown-toggle repeater-actions-button" data-toggle="dropdown" data-flip="auto" aria-expanded="false"><span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right" role="menu">'+s+"</ul></div>";if(a.length<1){var c=e('<div class="actions-column-wrapper" style="width: '+this.list_actions_width+'px"></div>').insertBefore(r),p=r.clone().addClass("table-actions");if(p.find("th:not(:last-child)").remove(),p.find("tr td:not(:last-child)").remove(),"multi"===this.viewOptions.list_selectable||"action"===this.viewOptions.list_selectable)p.find("thead tr").html('<th><div class="repeater-list-heading">'+d+"</div></th>"),"action"!==this.viewOptions.list_selectable&&p.find("thead .btn").attr("disabled","disabled");else{var h=this.viewOptions.list_actions.label||'<span class="actions-hidden">a</span>';p.find("thead tr").addClass("empty-heading").html("<th>"+h+'<div class="repeater-list-heading">'+h+"</div></th>")}p.find("td").each(function(t){e(this).html(d),e(this).find("a").attr("data-row",parseInt([t])+1)}),c.append(p),this.$canvas.addClass("actions-enabled")}this.list_sizeActionsTable(),this.$element.find(".table-actions tbody .action-item").on("click",function(t){if(!n.isDisabled){var i=e(this).data("action"),s=e(this).data("row"),r={actionName:i,rows:[s]};n.list_getActionItems(r,t)}}),this.$element.find(".table-actions thead .action-item").on("click",function(t){if(!n.isDisabled){var i=e(this).data("action"),s={actionName:i,rows:[]},r=".repeater-list-wrapper > table .selected";"action"===n.viewOptions.list_selectable&&(r=".repeater-list-wrapper > table tr"),n.$element.find(r).each(function(){var t=e(this).index();t+=1,s.rows.push(t)}),n.list_getActionItems(s,t)}})},e.fn.repeater.Constructor.prototype.list_getActionItems=function(t,i){var s,n=[],r=e.grep(this.viewOptions.list_actions.items,function(e){return e.name===t.actionName})[0];for(s=0;s<t.rows.length;s++){var a=this.$canvas.find(".repeater-list-wrapper > table tbody tr:nth-child("+t.rows[s]+")");n.push({item:a,rowData:a.data("item_data")})}if(1===n.length&&(n=n[0]),r.clickAction){var l=function(){};r.clickAction(n,l,i)}},e.fn.repeater.Constructor.prototype.list_sizeActionsTable=function(){var t=this.$element.find(".repeater-list table.table-actions"),i=t.find("thead tr th"),s=this.$element.find(".repeater-list-wrapper > table");i.outerHeight(s.find("thead tr th").outerHeight()),i.find(".repeater-list-heading").outerHeight(i.outerHeight()),t.find("tbody tr td:first-child").each(function(t,i){e(this).outerHeight(s.find("tbody tr:eq("+t+") td").outerHeight())})},e.fn.repeater.Constructor.prototype.list_sizeFrozenColumns=function(){var t=this.$element.find(".repeater-list .repeater-list-wrapper > table");this.$element.find(".repeater-list table.table-frozen tr").each(function(i){e(this).height(t.find("tr:eq("+i+")").height())});var i=t.find("td:eq(0)").outerWidth();this.$element.find(".frozen-column-wrapper, .frozen-thead-wrapper").width(i)},e.fn.repeater.Constructor.prototype.list_frozenOptionsInitialize=function(){function t(e){r.list_revertingCheckbox=!0,e.checkbox("toggle"),delete r.list_revertingCheckbox}var i=this.$element.find(".frozen-column-wrapper .checkbox-inline"),s=this.$element.find(".header-checkbox .checkbox-custom"),n=this.$element.find(".repeater-list table"),r=this;this.$element.find("tr.selectable").on("mouseover mouseleave",function(t){var i=e(this).index();i+=1,"mouseover"===t.type?n.find("tbody tr:nth-child("+i+")").addClass("hovered"):n.find("tbody tr:nth-child("+i+")").removeClass("hovered")}),s.checkbox(),i.checkbox();var a=this.$element.find(".table-frozen tbody .checkbox-inline"),l=this.$element.find(".frozen-thead-wrapper thead .checkbox-inline input");a.on("change",function(i){if(i.preventDefault(),!r.list_revertingCheckbox)if(r.isDisabled)t(e(i.currentTarget));else{var s=e(this).attr("data-row");s=parseInt(s)+1,r.$element.find(".repeater-list-wrapper > table tbody tr:nth-child("+s+")").click();var n=r.$element.find(".table-frozen tbody .checkbox-inline.checked").length;0===n?(l.prop("checked",!1),l.prop("indeterminate",!1)):n===a.length?(l.prop("checked",!0),l.prop("indeterminate",!1)):(l.prop("checked",!1),l.prop("indeterminate",!0))}}),l.on("change",function(s){r.list_revertingCheckbox||(r.isDisabled?t(e(s.currentTarget)):e(this).is(":checked")?(r.$element.find(".repeater-list-wrapper > table tbody tr:not(.selected)").click(),r.$element.trigger("selected.fu.repeaterList",i)):(r.$element.find(".repeater-list-wrapper > table tbody tr.selected").click(),r.$element.trigger("deselected.fu.repeaterList",i)))})},e.fn.repeater.defaults=e.extend({},e.fn.repeater.defaults,{list_columnRendered:null,list_columnSizing:!0,list_columnSyncing:!0,list_highlightSortedColumn:!0,list_infiniteScroll:!1,list_noItemsHTML:"no items found",list_selectable:!1,list_sortClearing:!1,list_rowRendered:null,list_frozenColumns:0,list_actions:!1}),e.fn.repeater.viewTypes.list={cleared:function(){this.viewOptions.list_columnSyncing&&this.list_sizeHeadings()},dataOptions:function(e){return this.list_sortDirection&&(e.sortDirection=this.list_sortDirection),this.list_sortProperty&&(e.sortProperty=this.list_sortProperty),e},enabled:function(e){this.viewOptions.list_actions&&(e.status?(this.$canvas.find(".repeater-actions-button").removeAttr("disabled"),d.call(this)):this.$canvas.find(".repeater-actions-button").attr("disabled","disabled"))},initialize:function(e,t){this.list_sortDirection=null,this.list_sortProperty=null,this.list_specialBrowserClass=o(),this.list_actions_width=void 0!==this.viewOptions.list_actions.width?this.viewOptions.list_actions.width:37,this.list_noItems=!1,t()},resize:function(){l.call(this,this.$element.find(".repeater-list-wrapper > table thead tr")),this.viewOptions.list_actions&&this.list_sizeActionsTable(),(this.viewOptions.list_frozenColumns||"multi"===this.viewOptions.list_selectable)&&this.list_sizeFrozenColumns(),this.viewOptions.list_columnSyncing&&this.list_sizeHeadings()},selected:function(){var e,t=this.viewOptions.list_infiniteScroll;this.list_firstRender=!0,this.$loader.addClass("noHeader"),t&&(e="object"==typeof t?t:{},this.infiniteScrolling(!0,e))},before:function(t){var i,s=t.container.find(".repeater-list"),n=this;return t.data.count>0?this.list_noItems=!1:this.list_noItems=!0,s.length<1&&(s=e('<div class="repeater-list '+this.list_specialBrowserClass+'" data-preserve="shallow"><div class="repeater-list-wrapper" data-infinite="true" data-preserve="shallow"><table aria-readonly="true" class="table" data-preserve="shallow" role="grid"></table></div></div>'),s.find(".repeater-list-wrapper").on("scroll.fu.repeaterList",function(){n.viewOptions.list_columnSyncing&&n.list_positionHeadings()}),(n.viewOptions.list_frozenColumns||n.viewOptions.list_actions||"multi"===n.viewOptions.list_selectable)&&t.container.on("scroll.fu.repeaterList",function(){n.list_positionColumns()}),t.container.append(s)),t.container.removeClass("actions-enabled actions-enabled multi-select-enabled"),i=s.find("table"),a.call(this,i,t.data),r.call(this,i,t.data),!1},renderItem:function(e){return n.call(this,e.container,e.subset,e.index),!1},after:function(){var e;return!this.viewOptions.list_frozenColumns&&"multi"!==this.viewOptions.list_selectable||this.list_noItems||this.list_setFrozenColumns(),this.viewOptions.list_actions&&!this.list_noItems&&(this.list_createItemActions(),this.list_sizeActionsTable()),!this.viewOptions.list_frozenColumns&&!this.viewOptions.list_actions&&"multi"!==this.viewOptions.list_selectable||this.list_noItems||(this.list_positionColumns(),this.list_frozenOptionsInitialize()),this.viewOptions.list_columnSyncing&&(this.list_sizeHeadings(),this.list_positionHeadings()),e=this.$canvas.find(".repeater-list-wrapper > table .repeater-list-heading.sorted"),e.length>0&&this.list_highlightColumn(e.data("fu_item_index")),!1}})});