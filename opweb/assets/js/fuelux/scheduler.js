!function(e){"function"==typeof define&&define.amd?define(["jquery","fuelux/combobox","fuelux/datepicker","fuelux/radio","fuelux/selectlist","fuelux/spinbox"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./combobox"),require("./datepicker"),require("./radio"),require("./selectlist"),require("./spinbox")):e(jQuery)}(function(e){if(!(e.fn.combobox&&e.fn.datepicker&&e.fn.radio&&e.fn.selectlist&&e.fn.spinbox))throw new Error("Fuel UX scheduler control requires combobox, datepicker, radio, selectlist, and spinbox.");var t=e.fn.scheduler,i=function(t,i){var s=this;this.$element=e(t),this.options=e.extend({},e.fn.scheduler.defaults,i),this.$startDate=this.$element.find(".start-datetime .start-date"),this.$startTime=this.$element.find(".start-datetime .start-time"),this.$timeZone=this.$element.find(".timezone-container .timezone"),this.$repeatIntervalPanel=this.$element.find(".repeat-every-panel"),this.$repeatIntervalSelect=this.$element.find(".repeat-options"),this.$repeatIntervalSpinbox=this.$element.find(".repeat-every"),this.$repeatIntervalTxt=this.$element.find(".repeat-every-text"),this.$end=this.$element.find(".repeat-end"),this.$endSelect=this.$end.find(".end-options"),this.$endAfter=this.$end.find(".end-after"),this.$endDate=this.$end.find(".end-on-date"),this.$recurrencePanels=this.$element.find(".repeat-panel"),this.$repeatIntervalSelect.selectlist(),this.$element.find(".selectlist").selectlist(),this.$startDate.datepicker(this.options.startDateOptions);var a="function"==typeof this.options.startDateChanged?this.options.startDateChanged:this._guessEndDate;this.$startDate.on("change changed.fu.datepicker dateClicked.fu.datepicker",e.proxy(a,this)),this.$startTime.combobox(),""===this.$startTime.find("input").val()&&this.$startTime.combobox("selectByIndex",0),"0"===this.$repeatIntervalSpinbox.find("input").val()?this.$repeatIntervalSpinbox.spinbox({value:1,min:1,limitToStep:!0}):this.$repeatIntervalSpinbox.spinbox({min:1,limitToStep:!0}),this.$endAfter.spinbox({value:1,min:1,limitToStep:!0}),this.$endDate.datepicker(this.options.endDateOptions),this.$element.find(".radio-custom").radio(),this.$repeatIntervalSelect.on("changed.fu.selectlist",e.proxy(this.repeatIntervalSelectChanged,this)),this.$endSelect.on("changed.fu.selectlist",e.proxy(this.endSelectChanged,this)),this.$element.find(".repeat-days-of-the-week .btn-group .btn").on("change.fu.scheduler",function(e,t){s.changed(e,t,!0)}),this.$element.find(".combobox").on("changed.fu.combobox",e.proxy(this.changed,this)),this.$element.find(".datepicker").on("changed.fu.datepicker",e.proxy(this.changed,this)),this.$element.find(".datepicker").on("dateClicked.fu.datepicker",e.proxy(this.changed,this)),this.$element.find(".selectlist").on("changed.fu.selectlist",e.proxy(this.changed,this)),this.$element.find(".spinbox").on("changed.fu.spinbox",e.proxy(this.changed,this)),this.$element.find(".repeat-monthly .radio-custom, .repeat-yearly .radio-custom").on("change.fu.scheduler",e.proxy(this.changed,this))},s=function(e,t){var i,s="";return s+=e.getFullYear(),s+=t,i=e.getMonth()+1,s+=i<10?"0"+i:i,s+=t,i=e.getDate(),s+=i<10?"0"+i:i},a={secondly:1e3,minutely:6e4,hourly:36e5,daily:864e5,weekly:6048e5,monthly:3024e6,yearly:314496e5},n=function(e,t,i,s){return new Date(e.getTime()+a[i]*s)};i.prototype={constructor:i,destroy:function(){var t;return this.$element.find("input").each(function(){e(this).attr("value",e(this).val())}),this.$element.find(".datepicker .calendar").empty(),t=this.$element[0].outerHTML,this.$element.find(".combobox").combobox("destroy"),this.$element.find(".datepicker").datepicker("destroy"),this.$element.find(".selectlist").selectlist("destroy"),this.$element.find(".spinbox").spinbox("destroy"),this.$element.find(".radio-custom").radio("destroy"),this.$element.remove(),t},changed:function(t,i,s){s||t.stopPropagation(),this.$element.trigger("changed.fu.scheduler",{data:void 0!==i?i:e(t.currentTarget).data(),originalEvent:t,value:this.getValue()})},disable:function(){this.toggleState("disable")},enable:function(){this.toggleState("enable")},setUtcTime:function(e,t,i){var s=e.split("-"),a=t.split(":"),n=new Date(Date.UTC(s[0],s[1]-1,s[2],a[0],a[1],a[2]?a[2]:0));if("Z"===i)n.setUTCHours(n.getUTCHours()+0);else{var r=[];r[0]="(.)",r[1]=".*?",r[2]="\\d",r[3]=".*?",r[4]="(\\d)";var l=new RegExp(r.join(""),["i"]),d=l.exec(i);if(null!==d){var o=d[1],h=d[2],c="+"===o?1:-1;n.setUTCHours(n.getUTCHours()+c*parseInt(h,10))}}var m=n.getTimezoneOffset();return n.setMinutes(m),n},endSelectChanged:function(e,t){var i,s;t?s=t.value:(i=this.$endSelect.selectlist("selectedItem"),s=i.value),this.$endAfter.parent().addClass("hidden"),this.$endAfter.parent().attr("aria-hidden","true"),this.$endDate.parent().addClass("hidden"),this.$endDate.parent().attr("aria-hidden","true"),"after"===s?(this.$endAfter.parent().removeClass("hide hidden"),this.$endAfter.parent().attr("aria-hidden","false")):"date"===s&&(this.$endDate.parent().removeClass("hide hidden"),this.$endDate.parent().attr("aria-hidden","false"))},_guessEndDate:function(){var e=this.$repeatIntervalSelect.selectlist("selectedItem").value,t=new Date(this.$endDate.datepicker("getDate")),i=new Date(this.$startDate.datepicker("getDate")),s=this.$repeatIntervalSpinbox.find("input").val();"none"!==e&&t<=i&&(this.$repeatIntervalSpinbox.is(":visible")||(s=1),"weekdays"===e&&(s=1,e="weekly"),t=n(i,0,e,s),this.$endDate.datepicker("setDate",t))},getValue:function(){var t,i=this.$repeatIntervalSpinbox.spinbox("value"),a="",n=this.$repeatIntervalSelect.selectlist("selectedItem").value;this.$startTime.combobox("selectedItem").value?(t=this.$startTime.combobox("selectedItem").value,t=t.toLowerCase()):t=this.$startTime.combobox("selectedItem").text.toLowerCase();var r,l,d,o,h,c,m,u,p=this.$timeZone.selectlist("selectedItem");m=""+s(this.$startDate.datepicker("getDate"),"-"),m+="T",d=t.search("am")>=0,o=t.search("pm")>=0,t=e.trim(t.replace(/am/g,"").replace(/pm/g,"")).split(":"),t[0]=parseInt(t[0],10),t[1]=parseInt(t[1],10),d&&t[0]>11?t[0]=0:o&&t[0]<12&&(t[0]+=12),m+=t[0]<10?"0"+t[0]:t[0],m+=":",m+=t[1]<10?"0"+t[1]:t[1],m+="+00:00"===p.offset?"Z":p.offset,"none"===n?a="FREQ=DAILY;INTERVAL=1;COUNT=1;":"secondly"===n?(a="FREQ=SECONDLY;",a+="INTERVAL="+i+";"):"minutely"===n?(a="FREQ=MINUTELY;",a+="INTERVAL="+i+";"):"hourly"===n?(a="FREQ=HOURLY;",a+="INTERVAL="+i+";"):"daily"===n?(a+="FREQ=DAILY;",a+="INTERVAL="+i+";"):"weekdays"===n?(a+="FREQ=WEEKLY;",a+="BYDAY=MO,TU,WE,TH,FR;",a+="INTERVAL=1;"):"weekly"===n?(l=[],this.$element.find(".repeat-days-of-the-week .btn-group input:checked").each(function(){l.push(e(this).data().value)}),a+="FREQ=WEEKLY;",a+="BYDAY="+l.join(",")+";",a+="INTERVAL="+i+";"):"monthly"===n?(a+="FREQ=MONTHLY;",a+="INTERVAL="+i+";",u=this.$element.find("input[name=repeat-monthly]:checked").val(),"bymonthday"===u?(r=parseInt(this.$element.find(".repeat-monthly-date .selectlist").selectlist("selectedItem").text,10),a+="BYMONTHDAY="+r+";"):"bysetpos"===u&&(l=this.$element.find(".repeat-monthly-day .month-days").selectlist("selectedItem").value,c=this.$element.find(".repeat-monthly-day .month-day-pos").selectlist("selectedItem").value,a+="BYDAY="+l+";",a+="BYSETPOS="+c+";")):"yearly"===n&&(a+="FREQ=YEARLY;",u=this.$element.find("input[name=repeat-yearly]:checked").val(),"bymonthday"===u?(h=this.$element.find(".repeat-yearly-date .year-month").selectlist("selectedItem").value,r=this.$element.find(".repeat-yearly-date .year-month-day").selectlist("selectedItem").text,a+="BYMONTH="+h+";",a+="BYMONTHDAY="+r+";"):"bysetpos"===u&&(l=this.$element.find(".repeat-yearly-day .year-month-days").selectlist("selectedItem").value,c=this.$element.find(".repeat-yearly-day .year-month-day-pos").selectlist("selectedItem").value,h=this.$element.find(".repeat-yearly-day .year-month").selectlist("selectedItem").value,a+="BYDAY="+l+";",a+="BYSETPOS="+c+";",a+="BYMONTH="+h+";"));var f=this.$endSelect.selectlist("selectedItem").value,y="";return"none"!==n&&("after"===f?y="COUNT="+this.$endAfter.spinbox("value")+";":"date"===f&&(y="UNTIL="+s(this.$endDate.datepicker("getDate"),"")+";")),a+=y,a=";"===a.substring(a.length-1)?a.substring(0,a.length-1):a,{startDateTime:m,timeZone:p,recurrencePattern:a}},repeatIntervalSelectChanged:function(e,t){var i,s,a;switch(t?(s=t.value,a=t.text):(i=this.$repeatIntervalSelect.selectlist("selectedItem"),s=i.value||"",a=i.text||""),this.$repeatIntervalTxt.text(a),s.toLowerCase()){case"hourly":case"daily":case"weekly":case"monthly":this.$repeatIntervalPanel.removeClass("hide hidden"),this.$repeatIntervalPanel.attr("aria-hidden","false");break;default:this.$repeatIntervalPanel.addClass("hidden"),this.$repeatIntervalPanel.attr("aria-hidden","true")}this.$recurrencePanels.addClass("hidden"),this.$recurrencePanels.attr("aria-hidden","true"),this.$element.find(".repeat-"+s).removeClass("hide hidden"),this.$element.find(".repeat-"+s).attr("aria-hidden","false"),"none"===s?(this.$end.addClass("hidden"),this.$end.attr("aria-hidden","true")):(this.$end.removeClass("hide hidden"),this.$end.attr("aria-hidden","false")),this._guessEndDate()},_parseAndSetRecurrencePattern:function(e,t){var i,s,a,n,r={},l=0,d="",o=e.toUpperCase().split(";");for(l=0;l<o.length;l++)""!==o[l]&&(d=o[l].split("="),r[d[0]]=d[1]);if("DAILY"===r.FREQ)d="MO,TU,WE,TH,FR"===r.BYDAY?"weekdays":"1"===r.INTERVAL&&"1"===r.COUNT?"none":"daily";else if("SECONDLY"===r.FREQ)d="secondly";else if("MINUTELY"===r.FREQ)d="minutely";else if("HOURLY"===r.FREQ)d="hourly";else if("WEEKLY"===r.FREQ){if(d="weekly",r.BYDAY)if("MO,TU,WE,TH,FR"===r.BYDAY)d="weekdays";else{var h=this.$element.find(".repeat-days-of-the-week .btn-group");for(h.find("label").removeClass("active"),i=r.BYDAY.split(","),l=0;l<i.length;l++)h.find('input[data-value="'+i[l]+'"]').prop("checked",!0).parent().addClass("active")}}else if("MONTHLY"===r.FREQ){if(this.$element.find(".repeat-monthly input").removeAttr("checked").removeClass("checked"),this.$element.find(".repeat-monthly label.radio-custom").removeClass("checked"),r.BYMONTHDAY)s=this.$element.find(".repeat-monthly-date"),s.find("input").addClass("checked").prop("checked",!0),s.find("label.radio-custom").addClass("checked"),s.find(".selectlist").selectlist("selectByValue",r.BYMONTHDAY);else if(r.BYDAY){var c=this.$element.find(".repeat-monthly-day");c.find("input").addClass("checked").prop("checked",!0),c.find("label.radio-custom").addClass("checked"),r.BYSETPOS&&c.find(".month-day-pos").selectlist("selectByValue",r.BYSETPOS),c.find(".month-days").selectlist("selectByValue",r.BYDAY)}d="monthly"}else"YEARLY"===r.FREQ?(this.$element.find(".repeat-yearly input").removeAttr("checked").removeClass("checked"),this.$element.find(".repeat-yearly label.radio-custom").removeClass("checked"),r.BYMONTHDAY?(a=this.$element.find(".repeat-yearly-date"),a.find("input").addClass("checked").prop("checked",!0),a.find("label.radio-custom").addClass("checked"),r.BYMONTH&&a.find(".year-month").selectlist("selectByValue",r.BYMONTH),a.find(".year-month-day").selectlist("selectByValue",r.BYMONTHDAY)):r.BYSETPOS&&(n=this.$element.find(".repeat-yearly-day"),n.find("input").addClass("checked").prop("checked",!0),n.find("label.radio-custom").addClass("checked"),n.find(".year-month-day-pos").selectlist("selectByValue",r.BYSETPOS),r.BYDAY&&n.find(".year-month-days").selectlist("selectByValue",r.BYDAY),r.BYMONTH&&n.find(".year-month").selectlist("selectByValue",r.BYMONTH)),d="yearly"):d="none";if(r.COUNT)this.$endAfter.spinbox("value",parseInt(r.COUNT,10)),this.$endSelect.selectlist("selectByValue","after");else if(r.UNTIL){var m,u;8===r.UNTIL.length&&(m=r.UNTIL.split(""),m.splice(4,0,"-"),m.splice(7,0,"-"),u=m.join(""));var p=this.$timeZone.selectlist("selectedItem"),f="+00:00"===p.offset?"Z":p.offset,y=this.setUtcTime(u,t.time24HourFormat,f);this.$endDate.datepicker("setDate",y),this.$endSelect.selectlist("selectByValue","date")}else this.$endSelect.selectlist("selectByValue","never");this.endSelectChanged(),r.INTERVAL&&this.$repeatIntervalSpinbox.spinbox("value",parseInt(r.INTERVAL,10)),this.$repeatIntervalSelect.selectlist("selectByValue",d),this.repeatIntervalSelectChanged()},_parseStartDateTime:function(t){var i,s,a,n={};return n.time24HourFormat=t.split("+")[0].split("-")[0],t.search(/\+/)>-1?n.timeZoneOffset="+"+e.trim(t.split("+")[1]):t.search(/\-/)>-1?n.timeZoneOffset="-"+e.trim(t.split("-")[1]):n.timeZoneOffset="+00:00",n.time24HourFormatSplit=n.time24HourFormat.split(":"),i=parseInt(n.time24HourFormatSplit[0],10),s=n.time24HourFormatSplit[1]?parseInt(n.time24HourFormatSplit[1].split("+")[0].split("-")[0].split("Z")[0],10):0,a=i<12?"AM":"PM",0===i?i=12:i>12&&(i-=12),s=s<10?"0"+s:s,n.time12HourFormat=i+":"+s,n.time12HourFormatWithPeriod=i+":"+s+" "+a,n},_parseTimeZone:function(t,i){return i.timeZoneQuerySelector="",t.timeZone?("string"==typeof t.timeZone?i.timeZoneQuerySelector+='li[data-name="'+t.timeZone+'"]':e.each(t.timeZone,function(e,t){i.timeZoneQuerySelector+="li[data-"+e+'="'+t+'"]'}),i.timeZoneOffset=t.timeZone.offset):t.startDateTime?(i.timeZoneOffset="+00:00"===i.timeZoneOffset?"Z":i.timeZoneOffset,i.timeZoneQuerySelector+='li[data-offset="'+i.timeZoneOffset+'"]'):i.timeZoneOffset="Z",i.timeZoneOffset},_setTimeUI:function(e){this.$startTime.find("input").val(e),this.$startTime.combobox("selectByText",e)},_setTimeZoneUI:function(e){this.$timeZone.selectlist("selectBySelector",e)},setValue:function(e){var t,i,s,a,n={};if(e.startDateTime)t=e.startDateTime.split("T"),i=t[0],s=t[1],s?(n=this._parseStartDateTime(s),this._setTimeUI(n.time12HourFormatWithPeriod)):(n.time12HourFormat="00:00",n.time24HourFormat="00:00");else{n.time12HourFormat="00:00",n.time24HourFormat="00:00";var r=this.$startDate.datepicker("getDate");i=r.getFullYear()+"-"+r.getMonth()+"-"+r.getDate()}this._parseTimeZone(e,n),n.timeZoneQuerySelector&&this._setTimeZoneUI(n.timeZoneQuerySelector),e.recurrencePattern&&this._parseAndSetRecurrencePattern(e.recurrencePattern,n),a=this.setUtcTime(i,n.time24HourFormat,n.timeZoneOffset),this.$startDate.datepicker("setDate",a)},toggleState:function(e){this.$element.find(".combobox").combobox(e),this.$element.find(".datepicker").datepicker(e),this.$element.find(".selectlist").selectlist(e),this.$element.find(".spinbox").spinbox(e),this.$element.find(".radio-custom").radio(e),e="disable"===e?"addClass":"removeClass",this.$element.find(".repeat-days-of-the-week .btn-group")[e]("disabled")},value:function(e){return e?this.setValue(e):this.getValue()}},e.fn.scheduler=function(t){var s,a=Array.prototype.slice.call(arguments,1),n=this.each(function(){var n=e(this),r=n.data("fu.scheduler"),l="object"==typeof t&&t;r||n.data("fu.scheduler",r=new i(this,l)),"string"==typeof t&&(s=r[t].apply(r,a))});return void 0===s?n:s},e.fn.scheduler.defaults={},e.fn.scheduler.Constructor=i,e.fn.scheduler.noConflict=function(){return e.fn.scheduler=t,this},e(document).on("mousedown.fu.scheduler.data-api","[data-initialize=scheduler]",function(t){var i=e(t.target).closest(".scheduler");i.data("fu.scheduler")||i.scheduler(i.data())}),e(function(){e("[data-initialize=scheduler]").each(function(){var t=e(this);t.data("scheduler")||t.scheduler(t.data())})})});