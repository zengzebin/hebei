!function(t){function e(e,n){this.element=e,this.settings=t.extend({},r,n),this.defaults=r,this.name=a,this.typeMap={json:this.toJson,txt:this.toTxt,csv:this.toCSV,doc:this.toDoc,xls:this.toExcel},this.uri={json:"data:application/json;base64,",txt:"data:csv/txt;charset=utf-8,",csv:"data:csv/txt;charset=utf-8,\ufeff",doc:"data:application/vnd.ms-doc;base64,",xls:"data:application/vnd.ms-excel;base64,"},this.base64=function(t){return window.btoa(unescape(encodeURIComponent(t)))},this.format=function(t,e){return t.replace(/{(\w+)}/g,function(t,n){return e[n]})},this.init()}function n(e,n){var o=t(e).clone();t.each(o.find("th,tr,td"),function(){"none"==t(this).css("display")&&t(this).remove()}),o.find(n.exclude).remove(),t.each(o.find("tbody>tr"),function(e){t.each(t(this).find("td"),function(e){var n=Number(t(this).attr("colspan"))||1;if(n>1)for(var o=0;o<n-1;o++){var i=t(this).clone(!0).removeAttr("colspan").removeAttr("rowspan");t(this).after(i),i.addClass("hide")}})});for(var i=t.map(o.find("tbody>tr"),function(e,n){return t(e).find("td").length}),a=Math.max.apply(null,i),r=o.find("tbody>tr").length,s=0;s<a;s++)for(var c=0;c<r;c++){var l=o.find("tbody>tr:nth-child("+(c+1)+")>td:nth-child("+(s+1)+")"),d=Number(l.attr("rowspan"))||1;if(d>1)for(var h=0;h<d-1;h++){var f=l.clone(!0).removeAttr("colspan").removeAttr("rowspan"),p=o.find("tbody>tr:nth-child("+(c+h+2)+")>td:nth-child("+(s+1)+")");p.before(f),f.addClass("hide")}}return t.each(o.find("tbody>tr>td"),function(){t(this).removeAttr("colspan").removeAttr("rowspan").removeClass("hide")}),o}function o(t){return(t.filename?t.filename:"table2export")+"."+t.type}function i(t){var e=t,n=-1!==t.indexOf(",")||-1!==t.indexOf("\r")||-1!==t.indexOf("\n"),o=-1!==t.indexOf('"');return o&&(e=e.replace(/"/g,'""')),(n||o)&&(e='"'+e+'"'),e}var a="table2export",r={exclude:".no-export",style:["color","backgroundColor","fontWeight","width","border","border-left","border-top","border-right","border-bottom"],name:"Table2Export",filename:"fileName",type:"xls"};e.prototype={init:function(){var t=this,e=t.settings.type;t.typeMap[e]?t.typeMap[e].call(t):console.log("不支持当前格式导出文件")},toJson:function(){var e=this,o="",i=[];t(e.element).each(function(o,a){var r=n(a,e.settings),s=[];r.find("thead").find("tr").each(function(){t(this).find("th").each(function(e){var n=t.trim(t(this).text()),o=t(this).find("input"),i=t(this).find("select");o.length>0?n=t.trim(o.val()):i.length>0&&(n=t.trim(i.find("option:selected").text())),s.push(n)})});var c=[];r.find("tbody").find("tr").each(function(e){t(this).find("td").each(function(){c[e]||(c[e]=[]);var n=t.trim(t(this).text()),o=t(this).find("input"),i=t(this).find("select");o.length>0?n=t.trim(o.val()):i.length>0&&(n=t.trim(i.find("option:selected").text())),c[e].push(n)})}),i.push({header:s,data:c})}),o=JSON.stringify(i),e.toExport(o)},toTxt:function(){this.toCSV()},toCSV:function(){var e=this,o="",a="";t(e.element).each(function(t,o){for(var r,s=n(o,e.settings),c=s[0],l=0;r=c.rows[l];l++){for(var d,h=0;d=r.cells[h];h++)a=a+(h?",":"")+i(d.innerHTML);a+="\r\n"}a+="\r\n"}),o=a,e.toExport(o)},toDoc:function(){this.toExcel()},toExcel:function(){var e=this;e.template={head:'<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="utf-8" />\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets>',sheet:{head:"<x:ExcelWorksheet><x:Name>",tail:"</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet>"},mid:"</x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body>",table:{head:'<table style="border-collapse: collapse;border-spacing: 0;border: 2px solid #ddd;">',tail:"</table>"},foot:"</body></html>"},e.tableRows=[],t(e.element).each(function(n,o){var i="";t(o).find("tr").not(e.settings.exclude).each(function(n,o){var a="";t(o).find("td,th").not(e.settings.exclude).each(function(n,o){var i=t(o).get(0).tagName,r=t(o).attr("colspan")?' colspan="'+t(o).attr("colspan")+'"':"",s=t(o).attr("rowspan")?' rowspan="'+t(o).attr("rowspan")+'"':"",c=e.settings.style,l="";t.each(c,function(e,n){l+=n+":"+t(o).css(n)+";"});var d=t.trim(t(this).text()),h=t(o).find("input"),f=t(o).find("select");h.length>0?d=t.trim(h.val()):f.length>0&&(d=t.trim(f.find("option:selected").text())),a+="<"+i+r+s+' style="'+l+'">'+d+"</"+i+">"}),i+="<tr>"+a+"</tr>"}),e.tableRows.push(i)}),e.tableToExcel(e.tableRows,e.settings.name)},tableToExcel:function(e,n){var o=this,i="";return o.ctx={worksheet:n||"Worksheet",table:e},i=o.template.head,t.isArray(e)&&t.each(e,function(t,e){i+=o.template.sheet.head+"Table"+t+o.template.sheet.tail}),i+=o.template.mid,t.isArray(e)&&t.each(e,function(t,e){i+=o.template.table.head+"{Table"+t+"}"+o.template.table.tail}),i+=o.template.foot,t.each(e,function(t,n){o.ctx["Table"+t]=e[t]}),delete o.ctx.table,i=o.format(i,o.ctx),o.toExport(i),!0},toExport:function(e){var n=this;if(window.navigator.userAgent.indexOf("MSIE")>0||window.navigator.userAgent.match(/Trident.*rv\:11\./))if("undefined"!=typeof Blob){e="csv"==n.settings.type?["\ufeff"+e]:[e];var i=new Blob(e,{type:"text/html,charset=utf-8"});window.navigator.msSaveBlob(i,o(n.settings))}else 0===t("#txtArea1").length&&t("<iframe width='600' height='600' id='txtArea1' style='display:none'></iframe>").prependTo("body"),txtArea1.document.open("text/html,charset=utf-8","replace"),"csv"==n.settings.type?txtArea1.document.write("\ufeff"+e):txtArea1.document.write(e),txtArea1.document.close(),txtArea1.focus(),sa=txtArea1.document.execCommand("SaveAs",!0,o(n.settings)),t("#txtArea1").remove();else{var a,r;if("csv"==n.settings.type||"txt"==n.settings.type){"csv"==n.settings.type&&(e="\ufeff"+e);var s=new Blob([e],{type:"text/csv,charset=utf-8"});a=URL.createObjectURL(s)}else a=n.uri[n.settings.type]+n.base64(e);r=document.createElement("a"),r.download=o(n.settings),r.href=a,r.click()}}},t.fn[a]=function(n){var o=this,i=n.type||"xls",r=new e(this,n);return o.each(function(e,n){t.data(n,"plugin_"+a+"_"+i,r)}),o}}(jQuery);