!function(e){"function"==typeof define&&define.amd?define(["jquery","humanize"],e):"object"==typeof exports?e(require("jquery"),require("humanize")):e(jQuery,Humanize)}(function(e,t){var a={formDataKey:"files",formDataKeyAdd:!0,buttonText:"Add Files",buttonClass:"file-preview-button",shadowClass:"file-preview-shadow",tableCss:"file-preview-table",tableRowClass:"file-preview-row",placeholderClass:"file-preview-placeholder",loadingCss:"file-preview-loading",tableTemplate:function(){return"<table class='table table-striped file-preview-table' id='file-preview-table'><tbody></tbody></table>"},rowTemplate:function(e){return"<tr class='"+config.tableRowClass+"'><td>"+(e.src?"<img src='"+e.src+"' class='"+e.placeholderCssClass+"' />":"<div class='"+e.placeholderCssClass+"' ></div>")+"<div class='file-preview-hidden'></div></td><td class='filename'>"+e.name+"</td><td class='filesize'>"+e.size+"</td><td class='remove-file'><button class='btn btn-danger'>&times;</button></td></tr>"},loadingTemplate:function(){return"<div id='file-preview-loading-container'><div id='"+config.loadingCss+"' class='loader-inner ball-clip-rotate-pulse no-show'><div></div><div></div></div></div>"}},i=function(e){return t.fileSize(e)},n=function(e){var t;return t=function(){switch(!0){case/video/.test(e):return"video";case/audio/.test(e):return"audio";case/pdf/.test(e):return"pdf";case/csv|excel/.test(e):return"spreadsheet";case/powerpoint/.test(e):return"powerpoint";case/msword|text/.test(e):return"document";case/zip/.test(e):return"zip";case/rar/.test(e):return"rar";default:return"default-filetype"}}(),a.placeholderClass+" "+t};e.fn.uploadPreviewer=function(t,r){var o=this;t||(t={}),config=e.extend({},a,t);var s,l,f,d,c,u=[];if(window.File&&window.FileReader&&window.FileList&&window.Blob){o.wrap("<span class='btn btn-primary "+config.shadowClass+"'></span>"),s=o.parent("."+config.shadowClass),s.prepend("<span>"+config.buttonText+"</span>"),s.wrap("<span class='"+config.buttonClass+"'></span>"),c=t.preview_table,c||(e("span."+config.buttonClass).after(config.tableTemplate()),c="table."+config.tableCss),f=e(c),f.addClass(config.tableCss),d=f.find("tbody"),l=t.preview_row_template||config.rowTemplate,f.after(config.loadingTemplate()),f.on("click",".remove-file",function(){for(var t=e(this).parent("tr"),a=t.find(".filename").text(),i=0;i<u.length;i++)if(u[i].name==a){u.splice(i,1);break}t.remove(),o.trigger(e.Event("file-preview:changed",{files:u}))});var p=0;return o.on("change",function(t){var a=e("#"+config.loadingCss);a.show();var s,f=t.currentTarget.files.length;e.each(t.currentTarget.files,function(t,c){"true"===o.attr("single")?(u[0]=c,s=new FileReader,s.onload=function(s){var u,g,v,m,w;if(d){g=c.type,/image/.test(g)?(w=s.target.result,m=config.placeholderClass+" image"):(w="",m=n(g)),u=i(c.size),v=e(l({src:w,name:c.name,placeholderCssClass:m,size:u}));var h=o.clone().removeAttr("id");config.formDataKeyAdd?h.attr("name",config.formDataKey+ ++p):h.attr("name",config.formDataKey+"[]"),h.appendTo(v.find(".file-preview-hidden")),d.html(v),t==f-1&&a.hide()}r&&r(s)},s.readAsDataURL(c)):(u.push(c),s=new FileReader,s.onload=function(s){var u,g,v,m,w;if(d){g=c.type,/image/.test(g)?(w=s.target.result,m=config.placeholderClass+" image"):(w="",m=n(g)),u=i(c.size),v=e(l({src:w,name:c.name,placeholderCssClass:m,size:u}));var h=o.clone().removeAttr("id");config.formDataKeyAdd?h.attr("name",config.formDataKey+ ++p):h.attr("name",config.formDataKey+"[]"),h.appendTo(v.find(".file-preview-hidden")),d.append(v),t==f-1&&a.hide()}r&&r(s)},s.readAsDataURL(c))}),setTimeout(function(){o.trigger(e.Event("file-preview:changed",{files:u})),o.val("")},100)}),o.fileList=function(){return u},o.clearFileList=function(){e(".remove-file").click()},o.url=function(e){if(void 0==e)return config.url;config.url=e},o._onComplete=function(t){o.trigger(e.Event("file-preview:submit:complete"))},o.submit=function(a,i){if(void 0==config.url)throw"Please set the URL to which I shall post the files";if(u.length>0){var n=new FormData;u.forEach(function(e){n.append(t.formDataKey+"[]",e)}),e.ajax({type:"POST",url:config.url,data:n,contentType:!1,processData:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){e.lengthComputable&&null!=t&&null!=t.uploadProgress&&"function"==typeof t.uploadProgress&&t.uploadProgress(e.loaded/e.total)},!1),e},success:function(e,t,i){"function"==typeof a&&a(e,t,i),o._onComplete({data:e,status:t,jqXHR:i})},error:function(e,t,a){"function"==typeof i&&i(e,t,a),o._onComplete({error:a,status:t,jqXHR:e})}})}else console.log("There are no selected files, please select at least one file before submitting."),o._onComplete({status:"no-files"})},o.data("file-preview",o),this}throw"The File APIs are not fully supported in this browser."}});