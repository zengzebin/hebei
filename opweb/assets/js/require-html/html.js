define(["text"],function(e){var n={};return{load:function(r,t,s,i){var a=r,c=a.split("/");-1==c[c.length-1].lastIndexOf(".")&&(a+=".html"),e.get(t.toUrl(a),function(t){for(var a in i.config.html)a in this.transform&&(t=this.transform[a](i.config.html[a],t));i.isBuild&&(n[r]=e.jsEscape(t)),s(t)}.bind(this),s.error)},write:function(e,r,t){if(n.hasOwnProperty(r)){t("define("+("'"+e+"!"+r+"'")+", "+("function () {return '"+n[r]+"';}")+");\n")}},transform:{comments:function(e,n){return"strip"===e?n.replace(/<!--(.|[\n\r])*?-->/gm,""):n},whitespaceBetweenTags:function(e,n){var r=/>[\n\r\s]+</gm;return"strip"===e?n.replace(r,"><"):"collapse"===e?n.replace(r,"> <"):n},whitespaceBetweenTagsAndText:function(e,n){var r=/>[\n\r\s]+/gm,t=/[\n\r\s]+</gm;return"strip"===e?n.replace(r,">").replace(t,"<"):"collapse"===e?n.replace(r,"> ").replace(t," <"):n},whitespaceWithinTags:function(e,n){if("collapse"===e){for(var r,t,s=/<([^>"']*?|"[^"]*?"|'[^']*?')+>/g,i=/([^\0\n\r\s"'>\/=]+)(?:\s*(=)\s*([^\n\r\s"'=><`]+|"[^"]*"|'[^']*'))?/gi,a=0,c="";null!==(r=s.exec(n));){if(c+=n.substring(a,r.index),t=r[0],/^<[^\/]/.test(t)){var l=t.match(i),o=l.shift(),f=/\/>$/.test(t)?"/>":">";c+=o+l.map(function(e){return e.replace(i," $1$2$3")}).join("")+f}else c+=t.replace(/[\n\r\s]+/g,"");a=s.lastIndex}return c+n.substring(a)}return n}}}});