define(["datatables","bootstrap-datetimepickerCN"],function(){var t,e=function(){$dict.init({name:"stcdType",url:$cfg.baseUrl+"/OptionSelect/com-ssxt-op-stcdType/"}),$dict.init({name:"addvcd",url:$cfg.baseUrl+"/addvcd/loadAll/"}),$dict.init({name:"maintainer",url:$cfg.baseUrl+"/users/loadAll/?isOperation=1"}),$dict.init({name:"serviceType",url:$cfg.baseUrl+"/OptionSelect/com-ssxt-op-serviceType/"}),$dict.init({name:"station",url:$cfg.baseUrl+"/stinfo/loadAll/"}),$dict.init({name:"warnType",url:$cfg.baseUrl+"/setting/loadAll/"})},n=function(){$("#c_startTime").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:!0,todayBtn:!0,pickerPosition:"bottom-left"}),$("#c_endTime").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:!0,todayBtn:!0,pickerPosition:"bottom-left"});var t,e=[];t=$dict.initOptions({elem:"#c_type",dict:"warnType",propText:function(t){return"超出"+t.remark},propId:"id",append:[{id:"-1",text:"全部"}]}),e.push(t),$.when.apply($,e).done(function(){a()}),$("#b_refresh,#b_search").on("click",function(){a()}),$("#b_setting").on("click",function(){i()})},a=function(){t&&t.fnDestroy();var e=$.extend({},$plugin.datatable_server,{fnServerData:function(t,e,n){var a=$.extend({},$opt.paramConvert(e),$opt.paramFilter({startTime:$("#c_startTime").val(),endTime:$("#c_endTime").val(),type:$("#c_type").val(),status:$("#c_status").val()})),i=$api.get({url:$cfg.baseUrl+"/warning/select",data:a});$.when(i).done(function(t){t.success?n($opt.dataConvert(t)):$toast.warning(t.msg)}).fail(function(t){$toast.error(t)})},aaSorting:[[0,"desc"]],columns:[{title:"报警时间",data:"time",class:"text-center"},{title:"测站编码",data:"code",class:"text-center"},{title:"测站名称",data:"code",class:"text-center",fnCreatedCell:function(t,e,n,a,i){$.when($dict.get("station")).then(function(){var n=$dict.getItem("station","stcd",e);$(t).html(n.stnm)})}},{title:"测站类型",data:"code",class:"text-center",fnCreatedCell:function(t,e,n,a,i){$.when($dict.get("station"),$dict.get("stcdType")).then(function(){var n=$dict.getItem("station","stcd",e),a=$dict.getItem("stcdType","trueValue",n.sttp);$(t).html(a.showValue)})}},{title:"行政区域",data:"code",class:"text-center",fnCreatedCell:function(t,e,n,a,i){$.when($dict.get("station"),$dict.get("addvcd")).then(function(){var n=$dict.getItem("station","stcd",e),a=$dict.getItem("addvcd","addvcd",n.addvcd);$(t).html(a.addvnm)})}},{title:"报警类型",data:"name",class:"text-center",fnCreatedCell:function(t,e,n,a,i){$.when($dict.get("warnType")).then(function(){var n=$dict.getItem("warnType","name",e);$(t).html("超出"+n.remark)})}},{title:"状态",data:"status",class:"text-center",fnCreatedCell:function(t,e,n,a,i){0===e?$(t).html('<span class="badge bg-red br-0">正在报警</span>'):1===e?$(t).html('<span class="badge bg-green br-0">已处理</span>'):$(t).html("")}},{title:"异常数据",data:"value",class:"text-center"}]});t=$("#t_station").dataTable(e)},i=function(){$.when($dict.get("warnType")).then(function(t){var e=$msg.dialog("settingAdd",function(t,e){var n,a=e.find("li.edited"),i=[];return e.find("li.error").length>0?($toast.warning("格式错误！"),!1):($.each(a,function(t,e){var a=$(e),c=a.attr("data-id"),d=a.find(".p_min").val(),s=a.find(".p_max").val();n=$api.put({url:$cfg.baseUrl+"/setting/update/"+c,data:{id:c,value:d+"-"+s}}),i.push(n)}),$.when.apply($,i).done(function(){$toast.success("更新成功！"),$dict.remove("warnType"),e.modal("hide")}),!1)},{title:"设置报警范围",data:{list:$.map(t,function(t){return $.extend({},t,{min:t.value.split("-")[0],max:t.value.split("-")[1]})})}});$.when(e).then(function(t){t.find("input").on("change",function(){$(this).parents("li").addClass("edited");var t=$(this).val();isNum(t)?$(this).parents("li").removeClass("error"):$(this).parents("li").addClass("error")})})})};return{data:{model:[{icon:"fa fa-globe",title:"支撑服务"},{icon:"",title:"异常值监控"}]},init:function(t){console.log(t+":init"),e(),n()},dispose:function(t){console.log(t+":dispose")}}});