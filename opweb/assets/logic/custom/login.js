define(["common","jquery-qrcode"],function(n){function o(){if(!0!==t){t=!0;var n={loginid:$("#loginid").val(),password:$.md5($("#password").val())},o=$api.post({url:$cfg.baseUrl+"/me/login",data:n});return $.when(o).done(function(n){if(t=!1,n.success){var o=n.data&&n.data.indexUrl||"";""===o&&(o="index.html#!dashboard"),sessionStorage.removeItem("userInfo"),sessionStorage.setItem("userInfo",JSON.stringify(n.data)),location.href=o}else $toast.warning(n.msg)}).fail(function(n){t=!1,$toast.error(n||"登录出错！")}),!0}}function e(){var n=$("#loginid").val();n?location.href="forgot.html?loginid="+n:$toast.warning("请填写账号")}function i(){$(".login-btn").on("click",function(){o()}),$(document).on("keydown",function(n){13===(n||(window.event?window.event:null)).keyCode&&o()}),$(".forgot-btn").on("click",function(){e()});var n=$api.loadXML("version.xml");if(null!==n){var i=n.getElementsByTagName("url")[0],t=i.innerHTML||i.childNodes[0].data.toString();$cfg.appDownloadUrl=t,$(".download-btn").on("click",function(){return $opt.downloadFile($cfg.appDownloadUrl)}),$(".qrcode").qrcode({render:"canvas",minVersion:3,maxVersion:40,ecLevel:"H",left:0,top:0,size:160,fill:"#1083f6",background:null,text:$cfg.appDownloadUrl,radius:0,quiet:0,mode:4,mSize:.3,mPosX:.5,mPosY:.5,label:"扫码下载APP",fontname:"sans",fontcolor:"#000",image:$("#apkIcon").get(0)})}}var t=!1;return{init:function(n){console.log(n+":init"),i()}}});