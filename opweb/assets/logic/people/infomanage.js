define(["handlebars","datatables","bootstrap-datetimepickerCN","jquery-uploadPreviewer"],function(t){var e,a,n,i,r,o={ignore:".ignore",errorPlacement:function(t,e){t.appendTo(e.parents(".form-group"))},rules:{loginId:{required:!0},name:{required:!0},roleId:{required:!0},addvcd:{required:!0}},messages:{loginId:{required:"请填写登录ID"},name:{required:"请填写用户名称"},roleId:{required:"请选择用户角色"},addvcd:{required:"请选择管理区域"}}},s=function(){$dict.init({name:"addvcd",url:$cfg.baseUrl+"/addvcd/loadAll/"}),$dict.init({name:"role",url:$cfg.baseUrl+"/role/loadAll/"}),$dict.init({name:"user",url:$cfg.baseUrl+"/users/loadAll/"}),$dict.init({name:"maintainer",url:$cfg.baseUrl+"/users/loadAll/?isOperation=1"})},d=function(){var t=$api.get({url:$cfg.baseUrl+"/statistics/maintenanceInfo"});$.when(t).done(function(t){if(t.success){var e=t.data;$("#p_total").html(e.total),$("#p_sign").html(e.clockNum),$("#p_wait").html(e.freeNum),$("#p_vacation").html(e.vacationNum)}else $toast.warning(t.msg)}).fail(function(t){$toast.error(t)})},c=function(){g(),d(),p(),$("#b_refresh,#b_search").on("click",function(){g(),d()}),$("#b_add").on("click",function(){h()}),$("#b_workday").on("click",function(){H()})},l=function(t){a&&a.fnDestroy();var e=$.extend({},$plugin.datatable_server,{fnServerData:function(e,a,n){var i=$.extend({},$opt.paramConvert(a),$opt.paramFilter({type:1,state:0})),r=$api.get({loading:!1,url:$cfg.baseUrl+"/work/vacationTravel",data:i});$.when(r).done(function(e){t.trigger("loading.hide"),e.success?n($opt.dataConvert(e)):$toast.warning(e.msg)}).fail(function(e){t.trigger("loading.hide"),$toast.error(e)})},aaSorting:[[0,"desc"]],iDisplayLength:5,autoWidth:!1,info:"",columns:[{title:"姓名",data:"name",class:"text-center"},{title:"开始时间",data:"startTime",class:"text-center",render:function(t,e,a){return moment(t).format("YYYY-MM-DD")}},{title:"结束时间",data:"endTime",class:"text-center",render:function(t,e,a){return moment(t).format("YYYY-MM-DD")}},{title:"原因",data:"reason",class:"text-center"},{title:"操作",data:"name",bSortable:!1,fnCreatedCell:function(t,e,a,n,i){var r=$('<a class="btn btn-danger btn-xs ml-5"><i class="fa fa-edit"></i>审批</a>');r.on("click",function(){q(t,e,a,n,i)}),$(t).html("").append(r)}}]});a=t.find(".table").dataTable(e),this.attach||(t.on("click",".box-add",function(){k(1)}),this.attach=!0)},u=function(t){n&&n.fnDestroy();var e=$.extend({},$plugin.datatable_server,{fnServerData:function(e,a,n){var i=$.extend({},$opt.paramConvert(a),$opt.paramFilter({type:2,state:0})),r=$api.get({loading:!1,url:$cfg.baseUrl+"/work/vacationTravel",data:i});$.when(r).done(function(e){t.trigger("loading.hide"),e.success?n($opt.dataConvert(e)):$toast.warning(e.msg)}).fail(function(e){t.trigger("loading.hide"),$toast.error(e)})},aaSorting:[[0,"desc"]],iDisplayLength:5,autoWidth:!1,info:"",columns:[{title:"姓名",data:"name",class:"text-center"},{title:"开始时间",data:"startTime",class:"text-center",render:function(t,e,a){return moment(t).format("YYYY-MM-DD")}},{title:"结束时间",data:"endTime",class:"text-center",render:function(t,e,a){return moment(t).format("YYYY-MM-DD")}},{title:"原因",data:"reason",class:"text-center"},{title:"操作",data:"name",bSortable:!1,fnCreatedCell:function(t,e,a,n,i){var r=$('<a class="btn btn-danger btn-xs ml-5"><i class="fa fa-edit"></i>审批</a>');r.on("click",function(){q(t,e,a,n,i)}),$(t).html("").append(r)}}]});n=t.find(".table").dataTable(e),this.attach||(t.on("click",".box-add",function(){k(2)}),this.attach=!0)},m=function(t){i&&i.fnDestroy();var e=$.extend({},$plugin.datatable_server,{fnServerData:function(e,a,n){var i=$.extend({},$opt.paramConvert(a),$opt.paramFilter({state:0})),r=$api.get({loading:!1,url:$cfg.baseUrl+"/users/quit",data:i});$.when(r).done(function(e){t.trigger("loading.hide"),e.success?n($opt.dataConvert(e)):$toast.warning(e.msg)}).fail(function(e){t.trigger("loading.hide"),$toast.error(e)})},aaSorting:[[0,"desc"]],iDisplayLength:5,autoWidth:!1,info:"",columns:[{title:"姓名",data:"name",class:"text-center"},{title:"离职时间",data:"quitTime",class:"text-center",render:function(t,e,a){return moment(t).format("YYYY-MM-DD")}},{title:"原因",data:"reason",class:"text-center"},{title:"操作",data:"name",bSortable:!1,fnCreatedCell:function(t,e,a,n,i){var r=$('<a class="btn btn-danger btn-xs ml-5"><i class="fa fa-edit"></i>审批</a>');r.on("click",function(){M(t,e,a,n,i)}),$(t).html("").append(r)}}]});i=t.find(".table").dataTable(e),this.attach||(t.on("click",".box-add",F),this.attach=!0)},f=function(t){r&&r.fnDestroy();var e=$.extend({},$plugin.datatable_server,{fnServerData:function(e,a,n){var i=$.extend({},$opt.paramConvert(a),$opt.paramFilter({})),r=$api.get({loading:!1,url:$cfg.baseUrl+"/work/temporary",data:i});$.when(r).done(function(e){t.trigger("loading.hide"),e.success?n($opt.dataConvert(e)):$toast.warning(e.msg)}).fail(function(e){t.trigger("loading.hide"),$toast.error(e)})},aaSorting:[[0,"desc"]],iDisplayLength:5,autoWidth:!1,info:"",columns:[{title:"被代班人",data:"temporaryUserId",class:"text-center",fnCreatedCell:function(t,e,a,n,i){$dict.get("user").then(function(a){$.each(a,function(a,n){n.id===e&&$(t).html(n.name)})})}},{title:"代班人",data:"userId",class:"text-center",fnCreatedCell:function(t,e,a,n,i){$dict.get("user").then(function(a){$.each(a,function(a,n){n.id===e&&$(t).html(n.name)})})}},{title:"开始时间",data:"startTime",class:"text-center",render:function(t,e,a){return moment(t).format("YYYY-MM-DD")}},{title:"结束时间",data:"endTime",class:"text-center",render:function(t,e,a){return moment(t).format("YYYY-MM-DD")}},{title:"原因",data:"reason",class:"text-center"},{title:"操作",data:"id",bSortable:!1,fnCreatedCell:function(t,e,a,n,i){var r=$('<a class="btn btn-danger btn-xs ml-5"><i class="fa fa-trash-o"></i>删除</a>');r.on("click",function(){N(t,e,a,n,i)}),$(t).html("").append(r)}}]});r=t.find(".table").dataTable(e),this.attach||(t.on("click",".box-add",P),this.attach=!0)},p=function(){var e=[{elem:$("#p_panel_1").get(0),data:{title:"休假管理"},initFunc:l},{elem:$("#p_panel_1").get(0),data:{title:"出差管理"},initFunc:u},{elem:$("#p_panel_1").get(0),data:{title:"离职管理"},initFunc:m},{elem:$("#p_panel_1").get(0),data:{title:"代班管理"},initFunc:f}],a=$(".panel-list");a.html(""),$.map(e,function(e){var n=e.html||e.elem.innerHTML.replace(/\[\[/g,"{{").replace(/]]/g,"}}"),i=t.compile(n)(e.data||{}),r=$(i);r.on("refresh",function(){$.isFunction(e.initFunc)&&(r.trigger("loading.show"),e.initFunc.apply(e,[r]))}),a.append(r),$.isFunction(e.initFunc)&&(e.attach=!1,e.initFunc.apply(e,[r]))})},g=function(){e&&e.fnDestroy();var t=$.extend({},$plugin.datatable_server,{fnServerData:function(t,e,a){var n=$.extend({},$opt.paramConvert(e),$opt.paramFilter({loginId:$("#c_loginId").val(),name:$("#c_name").val(),phone:$("#c_phone").val()})),i=$api.get({url:$cfg.baseUrl+"/users/repairPersonnel",data:n});$.when(i).done(function(t){t.success?a($opt.dataConvert(t)):$toast.warning(t.msg)}).fail(function(t){$toast.error(t)})},aaSorting:[[0,"desc"]],columns:[{title:"用户名称",data:"name",class:"text-center"},{title:"年龄",data:"age",class:"text-center"},{title:"工龄",data:"working",class:"text-center"},{title:"职位",data:"position",class:"text-center"},{title:"地址",data:"address",class:"text-center"},{title:"直属市局",data:"directlyUnder",class:"text-center",fnCreatedCell:function(t,e,a,n,i){$dict.get("addvcd").then(function(a){var n=(e||"").split(","),i=[];$.each(a,function(t,e){n.indexOf(e.addvcd)>-1&&i.push(e.addvnm)}),$(t).html(i.join(","))})}},{title:"手机",data:"phone",class:"text-center"},{title:"管理区域",data:"addvcd",class:"text-center",fnCreatedCell:function(t,e,a,n,i){$dict.get("addvcd").then(function(a){var n=(e||"").split(","),i=[];$.each(a,function(t,e){n.indexOf(e.addvcd)>-1&&i.push(e.addvnm)}),$(t).html(i.join(","))})}},{title:"操作",data:"id",bSortable:!1,fnCreatedCell:function(t,e,a,n,i){var r=$('<a class="btn btn-warning btn-xs ml-5"><i class="fa fa-edit"></i>修改</a>'),o=$('<a class="btn btn-danger btn-xs ml-5"><i class="fa fa-trash-o"></i>删除</a>'),s=$('<a class="btn btn-info btn-xs ml-5"><i class="fa fa-file-o"></i>查看</a>'),d=$('<a class="btn btn-success btn-xs ml-5"><i class="fa fa-picture-o"></i>头像</a>');r.on("click",function(){x(t,e,a,n,i)}),o.on("click",function(){w(t,e,a,n,i)}),s.on("click",function(){T(t,e,a,n,i)}),d.on("click",function(){y(t,e,a,n,i)}),$(t).html("").append(r).append(o).append(s).append(d)}}]});e=$("#t_sysuser").dataTable(t)},v=function(t){var e,a=[];e=$dict.initOptions({s2s:!0,elem:"#p_directlyUnder",dict:"addvcd",propText:"addvnm",propId:"addvcd",filter:function(t,e){var a=$.userData.addvcd;return("0000"===a.slice(-4)||"00"===a.slice(-2)&&t.addvcd.slice(0,-2)===a.slice(0,-2)||a===t.addvcd)&&"00"===t.addvcd.slice(-2)}}),a.push(e),e=$dict.initOptions({s2s:!0,elem:"#p_addvcd",dict:"addvcd",propText:"addvnm",propId:"addvcd",filter:function(t,e){var a=$.userData.addvcd;return("0000"===a.slice(-4)||"00"===a.slice(-2)&&t.addvcd.slice(0,-2)===a.slice(0,-2)||a===t.addvcd)&&"00"===t.addvcd.slice(-2)}}),a.push(e),e=$dict.initOptions({elem:"#p_roleId",dict:"role",propText:"name",propId:"id"}),a.push(e),e=$dict.initOptions({elem:"#p_createUserId",dict:"user",propText:"name",propId:"id"}),a.push(e),$.when.apply($,a).done(function(){$.isFunction(t)&&t()})},b={isEnable:1,isApp:0},h=function(){var t=$msg.dialog("peopleAdd",function(t,e){return $(e).find("form").submit(),!1},{title:"新增用户",modalClassName:"modal-lg"});$.when(t).then(function(t){var a=t.find("form");v(function(){a.formData(b),$.updateTextFields(),$("#p_createUserId").parents(".col-md-6").remove(),$("#p_createTime").parents(".col-md-6").remove();var n=$.extend({},o,{submitHandler:function(n){var i={},r=a.formData();$.extend(i,r);var o=$api.post({url:$cfg.baseUrl+"/users/add",data:$opt.paramFilter(i)});$.when(o).done(function(a){a.success?($toast.success(a.msg),t.modal("hide"),$dict.remove("user"),$dict.remove("maintainer"),e.fnUpdate()):$toast.warning(a.msg)}).fail(function(t){$toast.error(t)})}});a.validate(n),a.formDisable(!1)})})},x=function(t,a,n,i,r){var s=$msg.dialog("peopleAdd",function(t,e){return $(e).find("form").submit(),!1},{title:"修改用户信息",modalClassName:"modal-lg"}),d=$api.get({url:$cfg.baseUrl+"/users/load/"+n.id});$.when(s,d).then(function(t,a){var n=t.find("form");v(function(){$("#p_createUserId").parents(".col-md-6").remove(),$("#p_createTime").parents(".col-md-6").remove();var i=$.extend({},o,{submitHandler:function(a){var i={},r=n.formData();$.extend(i,r);var o=$api.put({url:$cfg.baseUrl+"/users/update/",data:$opt.paramFilter(i)});$.when(o).done(function(a){a.success?($toast.success(a.msg),t.modal("hide"),$dict.remove("user"),$dict.remove("maintainer"),e.fnUpdate()):$toast.warning(a.msg)}).fail(function(t){$toast.error(t)})}});if(n.validate(i),a.success){$toast.success(a.msg),a.data.addvcd=(a.data.addvcd||"").split(","),n.formData($.extend({},b,a.data)),$.updateTextFields(),n.formDisable(!1),$("#p_loginId").attr("disabled","true");var r=a.data.imageUrl;r?$cfg.picUrl&&(r=$cfg.picUrl+r):r="assets/img/uikits/photo.png",n.find("#p_pic").attr("src",r),n.find("#p_pic").removeClass("hide")}else $toast.warning(a.msg),t.modal("hide")})})},w=function(t,a,n,i,r){$msg.confirm("是否删除该记录?",function(){var t=$api.del({url:$cfg.baseUrl+"/users/delete/"+n.id});$.when(t).done(function(t){t.success?($toast.success(t.msg),$dict.remove("user"),$dict.remove("maintainer"),e.fnUpdate()):$toast.warning(t.msg)}).fail(function(t){$toast.error(t)})})},T=function(t,e,a,n,i){var r=$msg.dialog("peopleAdd",function(t,e){},{title:"用户信息",modalClassName:"modal-lg",buttons:{success:{label:"确定",className:"btn-info"}}}),o=$api.get({url:$cfg.baseUrl+"/users/load/"+a.id});$.when(r,o).then(function(t,e){var a=t.find("form");v(function(){if(a.formDisable(!0),e.success){$toast.success(e.msg),e.data.addvcd=(e.data.addvcd||"").split(","),a.formData($.extend({},b,e.data)),$.updateTextFields(),a.formDisable(!0);var n=e.data.imageUrl;n?$cfg.picUrl&&(n=$cfg.picUrl+n):n="assets/img/uikits/photo.png",a.find("#p_pic").attr("src",n),a.find("#p_pic").removeClass("hide")}else $toast.warning(e.msg),t.modal("hide")})})},y=function(t,e,a,n,i){var r=$msg.dialog("peoplePicAdd",function(t,e){return!1},{title:"人员头像",buttons:{success:{label:"确定",className:"btn-info"}}});$.when(r).then(function(t){var e=function(){var e=$api.get({url:$cfg.baseUrl+"/users/load/"+a.id});$.when(e).then(function(e){if(e.success){var a=e.data,n="";a.imageUrl?$cfg.picUrl&&(a.imageUrl=$cfg.picUrl+a.imageUrl):a.imageUrl="assets/img/uikits/photo.png",n+='<li><div class="col-md-4"><img class="w-150" src="'+a.imageUrl+'"></div><div class="col-md-3"><img class="w-100" src="'+a.imageUrl+'"></div><div class="col-md-3"><img class="w-80" src="'+a.imageUrl+'"></div></li>',t.find(".picture-list").html(n),setTimeout(function(){t.resize()},100)}else $toast.warning(e.msg)}).fail(function(t){$toast.error(t)})};e();var n=t.find("form");t.find("#p_file").uploadPreviewer({buttonText:'<i class="fa fa-plus-circle mr-5"></i>新增图片'}),t.find("#p_file").on("file-preview:changed",function(){t.resize()});var i=$.extend({},o,{submitHandler:function(t){var i=n.find("#p_file").data("file-preview"),r=i.fileList();if(Object.keys(r).length>0){var o=new FormData;$.each(r,function(t,e){o.append("file["+t+"]",e)});var s=$api.post({contentType:!1,processData:!1,url:$cfg.baseUrl+"/users/uploadImage/"+a.id,data:o});$.when(s).done(function(t){t.success?(e(),i.clearFileList(),$toast.success(t.msg)):$toast.warning(t.msg)}).fail(function(t){$toast.error(t)})}else $toast.warning("请添加上传文件")}});n.validate(i)})},D=function(t){var e,a=[];e=$dict.initOptions({elem:"#p_userId",dict:"maintainer",propText:"name",propId:"id"}),a.push(e),$("#p_startTime").datetimepicker({minView:2,format:"yyyy-mm-dd",autoclose:!0,todayBtn:!0,pickerPosition:"bottom-left"}),$("#p_endTime").datetimepicker({minView:2,format:"yyyy-mm-dd",autoclose:!0,todayBtn:!0,pickerPosition:"bottom-left"}),$.when.apply($,a).done(function(){$.isFunction(t)&&t()})},_={ignore:".ignore",errorPlacement:function(t,e){t.appendTo(e.parents(".form-group"))},rules:{userId:{required:!0},reason:{required:!0},startTime:{required:!0,startTime:"#p_endTime"},endTime:{required:!0,endTime:"#p_startTime"}},messages:{userId:{required:"请选择申请人"},reason:{required:"原因不能为空"},startTime:{required:"开始时间不能为空",startTime:"开始时间不能大于结束时间"},endTime:{required:"结束时间不能为空",endTime:"结束时间不能小于开始时间"}}},U={},k=function(t){var e=$msg.dialog("vacationAdd",function(t,e){return $(e).find("form").submit(),!1},{title:1===t?"新增请假申请":"新增出差申请"});$.when(e).then(function(e){var i=e.find("form");D(function(){i.formData(U),$.updateTextFields();var r=$.extend({},_,{submitHandler:function(r){var o={type:t,state:0},s=i.formData();$.extend(o,s);var d=$api.post({url:$cfg.baseUrl+"/work/vacationTravel",data:$opt.paramFilter(o)});$.when(d).done(function(i){i.success?($toast.success(i.msg),e.modal("hide"),1===t?a.fnUpdate():n.fnUpdate()):$toast.warning(i.msg)}).fail(function(t){$toast.error(t)})}});i.validate(r),i.formDisable(!1)})})},q=function(t,e,i,r,o){var s=$msg.dialog("vacationAuditAdd",function(t,e){return $(e).find("form").submit(),!1},{title:1===i.type?"请假申请审批":"出差申请审批"});$.when(s).then(function(t){var e=t.find("form");D(function(){var r=$.extend({},_,{submitHandler:function(r){var o={},s=e.formData();$.extend(o,{state:s.state});var d=$api.put({url:$cfg.baseUrl+"/work/vacationTravel/"+i.id,data:$opt.paramFilter(o)});$.when(d).done(function(e){e.success?($toast.success(e.msg),t.modal("hide"),1===i.type?a.fnUpdate():n.fnUpdate()):$toast.warning(e.msg)}).fail(function(t){$toast.error(t)})}});e.validate(r),e.formData($.extend({},U,i,{state:10})),$.updateTextFields(),e.formDisable(!0),$("#p_state").removeAttr("disabled").trigger("attr.update")})})},C=function(t){var e,a=[];e=$dict.initOptions({elem:"#p_userId",dict:"maintainer",propText:"name",propId:"id"}),a.push(e),$("#p_quitTime").datetimepicker({minView:2,format:"yyyy-mm-dd",autoclose:!0,todayBtn:!0,pickerPosition:"bottom-left"}),$.when.apply($,a).done(function(){$.isFunction(t)&&t()})},Y={ignore:".ignore",errorPlacement:function(t,e){t.appendTo(e.parents(".form-group"))},rules:{userId:{required:!0},reason:{required:!0},quitTime:{required:!0}},messages:{userId:{required:"请选择申请人"},reason:{required:"原因不能为空"},quitTime:{required:"离职时间不能为空"}}},I={},F=function(){var t=$msg.dialog("quitAdd",function(t,e){return $(e).find("form").submit(),!1},{title:"新增离职申请"});$.when(t).then(function(t){var e=t.find("form");C(function(){e.formData(I),$.updateTextFields();var n=$.extend({},Y,{submitHandler:function(n){var i={type:1,state:0},r=e.formData();$.extend(i,r);var o=$api.post({url:$cfg.baseUrl+"/users/quit",data:$opt.paramFilter(i)});$.when(o).done(function(e){e.success?($toast.success(e.msg),t.modal("hide"),a.fnUpdate()):$toast.warning(e.msg)}).fail(function(t){$toast.error(t)})}});e.validate(n),e.formDisable(!1)})})},M=function(t,e,n,i,r){var o=$msg.dialog("quitAuditAdd",function(t,e){return $(e).find("form").submit(),!1},{title:"离职申请审批"});$.when(o).then(function(t){var e=t.find("form");C(function(){var i=$.extend({},Y,{submitHandler:function(i){var r={},o=e.formData();$.extend(r,{state:o.state});var s=$api.put({url:$cfg.baseUrl+"/users/quit/"+n.id,data:$opt.paramFilter(r)});$.when(s).done(function(e){e.success?($toast.success(e.msg),t.modal("hide"),a.fnUpdate()):$toast.warning(e.msg)}).fail(function(t){$toast.error(t)})}});e.validate(i),e.formData($.extend({},I,n,{state:10})),$.updateTextFields(),e.formDisable(!0),$("#p_state").removeAttr("disabled").trigger("attr.update")})})},S=function(t){var e,a=[];e=$dict.initOptions({elem:"#p_temporaryUserId",dict:"maintainer",propText:"name",propId:"id"}),a.push(e),e=$dict.initOptions({elem:"#p_userId",dict:"maintainer",propText:"name",propId:"id"}),a.push(e),$("#p_startTime").datetimepicker({minView:2,format:"yyyy-mm-dd",autoclose:!0,todayBtn:!0,pickerPosition:"bottom-left"}),$("#p_endTime").datetimepicker({minView:2,format:"yyyy-mm-dd",autoclose:!0,todayBtn:!0,pickerPosition:"bottom-left"}),$.when.apply($,a).done(function(){$.isFunction(t)&&t()})},A={ignore:".ignore",errorPlacement:function(t,e){t.appendTo(e.parents(".form-group"))},rules:{temporaryUserId:{required:!0},userId:{required:!0,unequalTo:"#p_temporaryUserId"},reason:{required:!0},startTime:{required:!0,startTime:"#p_endTime"},endTime:{required:!0,endTime:"#p_startTime"}},messages:{temporaryUserId:{required:"请选择被代班人"},userId:{required:"请选择代班人",unequalTo:"代班人不能是被代班人"},reason:{required:"原因不能为空"},startTime:{required:"开始时间不能为空",startTime:"开始时间不能大于结束时间"},endTime:{required:"结束时间不能为空",endTime:"结束时间不能小于开始时间"}}},O={},P=function(){var t=$msg.dialog("proxyAdd",function(t,e){return $(e).find("form").submit(),!1},{title:"新增代班记录"});$.when(t).then(function(t){var e=t.find("form");S(function(){e.formData(O),$.updateTextFields();var a=$.extend({},A,{submitHandler:function(a){var n={},i=e.formData();$.extend(n,i);var o=$api.post({url:$cfg.baseUrl+"/work/temporary",data:$opt.paramFilter(n)});$.when(o).done(function(e){e.success?($toast.success(e.msg),t.modal("hide"),r.fnUpdate()):$toast.warning(e.msg)}).fail(function(t){$toast.error(t)})}});e.validate(a),e.formDisable(!1)})})},N=function(t,e,a,n,i){$msg.confirm("是否删除该记录?",function(){var t=$api.del({url:$cfg.baseUrl+"/work/temporary/"+a.id});$.when(t).done(function(t){t.success?($toast.success(t.msg),r.fnUpdate()):$toast.warning(t.msg)}).fail(function(t){$toast.error(t)})})},H=function(){var t=$msg.dialog("workDay",null,{title:"运维人员考勤情况",modalClassName:"modal-lg",buttons:{success:{label:"确定",className:"btn-info"}}});$.when(t).then(function(t){var e,a=function(a,n){var i=0,r=[{title:a.get("year")+"年<br/>序号",data:"userName",class:"min-w-50 text-center"},{title:a.get("months")+1+"月<br/>姓名",data:"userName",class:"min-w-100 text-center"}];n[0]&&n[0].data&&n[0].data.length>0&&(i=n[0].data.length);for(var o=0;o<i;o++){var s=moment(n[0].data[o].date),d=["周日","周一","周二","周三","周四","周五","周六"],c={title:s.get("date").toString()+"日<br/>"+d[s.get("day")],bSortable:!1,data:"data."+o,class:"min-w-40 text-center",fnCreatedCell:function(t,e,a,n,i){var r="";e.toWork&&0===e.state?r='<span class="badge bg-green br-5">签到</span>':1===e.state?r='<span class="badge bg-red br-5">请假</span>':2===e.state&&(r='<span class="badge bg-orange br-5">出差</span>'),$(t).html(r)}};r.push(c)}e&&(e.fnDestroy(),t.find("#p_table").html(""));var l=$.extend({},$plugin.datatable_local,{data:n,aaSorting:[[0,"desc"]],autoWidth:!1,info:"",columns:r,fnDrawCallback:function(){this.api().column(0).nodes().each(function(t,e){t.innerHTML=e+1})},scrollY:$(window).height()-400+"px",scrollX:!0,scrollCollapse:!0,paging:!1,fixedColumns:{leftColumns:2}});e=t.find("#p_table").dataTable(l),$(".dataTables_scrollBody").niceScroll({styler:"fb",cursorcolor:"#509fed",cursorwidth:"6",cursorborderradius:"15px",background:"#404040",cursorborder:"",zindex:"9990"}),t.resize()},n=function(){var e=moment(t.find("#p_time").val()),n=e.startOf("month").format("YYYY-MM-DD"),i=e.endOf("month").format("YYYY-MM-DD"),r=$api.get({url:$cfg.baseUrl+"/work/attendance",data:{startTime:n,endTime:i}});$.when(r).done(function(t){if(t.success){var n=t.data;a(e,n)}else $toast.warning(t.msg)}).fail(function(t){$toast.error(t)})};t.find("#p_time").val(moment().format("YYYY-MM")).datetimepicker({startView:3,minView:3,format:"yyyy-mm",autoclose:!0,todayBtn:!0,pickerPosition:"bottom-left"}),t.find("#p_search").on("click",function(){n()}),n()})};return{data:{model:[{icon:"fa fa-users",title:"人员管理"}]},init:function(t){console.log(t+":init"),s(),c()},dispose:function(t){console.log(t+":dispose")}}});